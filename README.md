# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с TS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

- src/components/base - базовые классы, от Яндекс Практикума
- src/components/features - функциональные классы, которые реализуют определённые фичи
- src/services - сервисы, в которые выносится логика


### Общий стиль проекта

Архитектура проекта построена по принципам MVVM с EventEmitter-реактивностью, где:

- View отвечает только за отображение и взаимодействие с пользователем
- Model содержит бизнес-логику, API-запросы и валидацию
- ViewModel реализован через OrderService, BasketService, который не хранит состояние, а только управляет событиями (через StatefulEventEmitterService), действуя как посредник между представлением и моделью

При этом реализована строгая декомпозиция, аналогичная MVP:
- Все DOM-элементы кэшируются(кроме компонента элемента списка корзины и элемента галереи) и не ищутся повторно
- Представление не знает ни о данных, ни о правилах валидации
- Логика бизнес-правил и отправки запроса находится в модели
- Коммуникация между слоями — через событийную систему (StatefulEventEmitterService)

## View (Компоненты)

Представление реализовано через компонентную архитектуру, основанную на иерархии классов `BaseComponent`, `CachedComponent` и `StatelessComponent`.

### Базовые принципы

- Каждый компонент реализует метод `render(): HTMLElement`, который возвращает HTML-элемент для вставки в DOM.
- Все DOM-элементы создаются из шаблонов (`<template>`) и **не ищутся повторно** — кэшируются при создании компонента.
- Компоненты **не содержат собственного состояния** — все данные приходят извне через параметры `render(...)` или события от сервисов.
- Компоненты **не управляют данными и валидацией** — всё передаётся в соответствующие сервисы (`OrderService`, `BasketService` и т. д.).

### Классы компонентов

- `BaseComponent` — абстрактный базовый класс, обеспечивает:
  - работу с шаблоном
  - регистрацию компонента в `ComponentRegistryService`
- `CachedComponent` — кэшируемый компонент:
  - DOM-элемент клонируется один раз в конструкторе
  - метод `render(...)` повторно возвращает один и тот же DOM-элемент
  - используется, если компонент нужно кэшировать (например, корзина)
- `StatelessComponent` — некэшируемый компонент:
  - каждый вызов `render(...)` создаёт новый DOM-элемент
  - применяется для динамически повторяющихся элементов (например, карточки товаров)

### Поведение компонентов

- `CachedComponent` реализует жизненный цикл: `constructor → _initCachedData → _afterInit → render(...)`.
- Подписка на данные и добавление обработчиков событий происходит в `_afterInit()`.
- Обновление DOM осуществляется вручную через вызов `_update(...)` внутри `render(...)`.

### Особенности

- Все компоненты автоматически регистрируются в `ComponentRegistryService` для их получения в случае необходимости.
- Взаимодействие между компонентами и сервисами строго одностороннее: компоненты **только отправляют события или вызывают методы**, но **не владеют данными**.
- Такая архитектура позволяет переиспользовать компоненты, избегать утечек памяти и легко управлять жизненным циклом компонентов.


## Model (Модель предметной области)

Слой Model реализован в реактивной архитектуре с разделением ответственности:

- **StatefulEventEmitterService** — централизованное хранилище состояния приложения. Оно управляет актуальными значениями (`Order`, `Basket`, `Products`) и распространяет изменения через события.
- **Фасадные сервисы** (`OrderService`, `BasketService`, `ProductsService`) инкапсулируют бизнес-логику работы с данными, не хранят состояние напрямую и взаимодействуют с моделью через `StatefulEventEmitterService`.
- **ValidationOrderService** — чистый сервис валидации, не связанный с UI. Используется фасадом модели для проверки корректности данных.
- **Api-сервисы** (`ApiOrderService`, `ApiProductsService`) — низкоуровневый слой доступа к данным, отделённый от модели. Не хранят состояния и не участвуют в бизнес-логике напрямую.

Модель в целом представлена как совокупность:
- реактивного хранилища состояния,
- сервисов бизнес-логики,
- вспомогательных инструментов (валидация, API-доступ).

---

## ViewModel (Оркестраторы сценариев и координаторы UI ↔ Model)

ViewModel-сервисы организуют бизнес-сценарии и координируют взаимодействие между Model и View:

- Используют `StatefulEventEmitterService` для чтения и изменения состояния модели.
- Реализуют прикладную бизнес-логику (например, поведение формы или корзины).
- Не содержат собственного состояния — работают поверх реактивной модели.

Примеры:
- `OrderService` — ViewModel формы заказа
- `BasketService` — ViewModel корзины
- `ProductsService` — ViewModel галереи

ViewModel не знает о DOM и UI-компонентах


**Почему MVVM, а не MVP?**

В классическом MVP презентер является координатором и сам вызывает обновления View. В данной архитектуре View и Model соединены через реактивную событийную модель. Это ближе к MVVM, где ViewModel (OrderService, BasketService) принимает команды и эмитит состояние, а View подписывается и обновляется

В данном случае архитектура ближе к MVP по ответственности классов, но реализована реактивно: через ViewModel-образный сервис (OrderService), который не содержит состояния, но управляет реактивной моделью формы. Это упрощает тестирование, уменьшает связанность и соответствует SRP

## **Использование DI (Dependency Injection)**

**Зачем нужен DI в проекте**

В проекте реализован контейнер зависимостей (registerDependencies()), обеспечивающий инверсию управления (IoC). Это означает, что классы не создают свои зависимости напрямую, а получают их извне — через конструктор

основные проблемы, которые решает DI:

| Проблема                             | Как решает DI                                                                       |
| ------------------------------------ | ----------------------------------------------------------------------------------- |
| Жёсткая связанность между модулями   | Компоненты не создают зависимости напрямую, а получают их от контейнера             |
| Сложность тестирования и мокирования | Любой сервис можно заменить на подделку при тестах                                  |
| Проблемы порядка инициализации       | Все зависимости явно зарегистрированы и разрешаются в нужном порядке                |
| Скрытые зависимости                  | Благодаря `deps` явно указано, что нужно каждому классу                             |
| Повторное использование              | Один и тот же сервис можно передавать разным компонентам (например, `OrderService`) |
| Централизованная точка конфигурации  | Все зависимости описаны в одном месте — `registerDependencies()`                    |

<br><br>
Как это выглядит:

```
container.register(OrderService, {
  deps: [StatefulEventEmitterService, ValidationOrderService, ApiOrderService, BasketService]
});
```

Этот код указывает, что OrderService не создает свои зависимости сам, а полагается на контейнер, который их предоставит. Благодаря этому:
- Появляется явная структура зависимостей
- Упрощается масштабирование проекта
- Классы становятся легче для повторного использования

Все зависимости между слоями реализованы через контейнер зависимостей — это позволяет строго контролировать структуру, избежать дублирования и повысить масштабируемость. Компоненты не создают сервисы сами, а получают нужные зависимости через конструктор, что соответствует принципам инверсии управления (IoC) и единственной ответственности (SRP)

**Итог: зачем DI**

В кратком виде:
- Делает архитектуру явной и масштабируемой
- Облегчает тестирование
- Соответствует принципам SOLID
- Удовлетворяет формулировке задания: «взаимодействие между классами реализуется вне самих классов»
- Разгружает классы от ответственности по созданию зависимостей

---

## Описание всех классов:
**AppController**  
Основной контроллер приложения, который отвечает за инициализацию, загрузку данных, отображение компонентов и подписку на события.

**Методы**  
| Метод                       | Аргументы | Возвращаемое значение | Описание                                                                                         |
| --------------------------- | --------- | --------------------- | ------------------------------------------------------------------------------------------------ |
| `constructor`               | См. выше  | —                     | Инициализация контроллера с передачей всех зависимостей                                          |
| `init`                      | —         | `void`                | Инициализация приложения: загрузка продуктов и установка подписок на события                     |
| `_loadProductsAndRender`    | —         | `void`                | Загружает список продуктов через сервис и передает их в компонент галереи                        |
| `_initCustomEventListeners` | —         | `void`                | Подписывается на кастомные события для открытия модальных окон и обновления информации в корзине |

---
`ApiService` — базовый сервисный класс для работы с API. Он наследуется от класса `Api`, автоматически устанавливая базовый URL для всех HTTP-запросов. Используется как промежуточный слой, чтобы избежать повторяющегося указания базового URL в каждом конкретном API-сервисе. Не имеет своих методов, только наследует методы от `Api`

---

`ApiProductsService` - cервисный класс для взаимодействия с продуктами через API. Наследуется от ApiService

getAll(): `Promise<Product[]>`
  Выполняет GET-запрос к '/product'.
  Возвращает массив объектов Product, полученных из поля items ответа

getById(id: string): `Promise<Product>`
  Выполняет GET-запрос к '/product/{id}'.
  Возвращает объект Product по его идентификатору.

---

`ApiOrderService` - cервисный класс для отправки заказов на сервер. Наследуется от ApiService

send(createOrderRequest: CreateOrderRequest): `Promise<CreateOrderResponse>`
  Выполняет POST-запрос к '/order', отправляя данные заказа.
  Принимает объект createOrderRequest, содержащий информацию о заказе.
  Возвращает промис с объектом ответа CreateOrderResponse

---

**StatefulEventEmitterService** 
расширение EventEmitter, которое запоминает последнее значение каждого события. Позволяет:
- немедленно получить последнее значение события при подписке;
- реактивно подписываться на изменения состояния;
- централизованно управлять и очищать кэшированные значения.

**Свойства**

| Имя           | Тип                                           | Описание                                                                                                               |
| ------------- | --------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| `_lastValues` | `Map<string, any>`                            | Хранит последние значения для событий, по ключу — имя события. Используется для немедленного вызова новых подписчиков. |
| `_events`     | `Map<EventName, Function[]>` *(унаследовано)* | Хранит список подписчиков событий (унаследовано от `EventEmitter`).                                                    |

**Методы**

| Метод                           | Доступ   | Возвращает         | Описание                                                                              |
| ------------------------------- | -------- | ------------------ | ------------------------------------------------------------------------------------- |
| `emitCached(eventName, data?)`  | `public` | `void`             | Сохраняет значение события и вызывает всех подписчиков.                               |
| `onCached(eventName, callback)` | `public` | `void`             | Подписывает обработчик и сразу вызывает его с последним значением (если оно есть).    |
| `offAllByEventName(eventName)`  | `public` | `void`             | Удаляет всех подписчиков указанного события и очищает последнее сохранённое значение. |
| `getLast(eventName)`            | `public` | `any \| undefined` | Возвращает последнее значение, сохранённое для указанного события.                    |
| `clearLast(eventName?)`         | `public` | `void`             | Очищает последнее значение одного события или всех событий.                           |


---

`OrderService` - cервис, инкапсулирующий бизнес-логику создания и отправки заказа. Работает через брокер событий `StatefulEventEmitterService` и API-клиент `ApiOrderService`

**Зависимости**
- StatefulEventEmitterService — управление состоянием и событиями заказа, которые кэшируются.
- ValidationOrderService — валидация данных заказа.
- ApiOrderService — отправка заказа на сервер.
- BasketService — получение информации о товарах в корзине
- EventEmitter - отправление стандартных событий о том, что нужно открывать модалку успешно выполненного заказа

**Методы**  
**Приватные**

  _emitOrderUpdate(partialOrder: `Partial<Order>`): void  
  Обновляет и эмитит новое состояние заказа.

  _getCurrentOrder(): `Partial<Order> `  
  Получает текущее состояние заказа.

**Публичные**

  updateEmail(email: string): void  
  Обновляет email в заказе.

  updatePhone(phone: string): void  
  Обновляет телефон в заказе.

  setAddress(address: string): void  
  Устанавливает адрес доставки.

  setPaymentMethod(payment: Payment): void  
  Устанавливает метод оплаты.

  clear(): void  
  Очищает текущее состояние заказа.

  onFormStateChange(fields: `(keyof Order)[]`, callback: (state: `{ isValid: boolean; errors: Partial<Record<keyof Order, string>> }) => void`): `() => void`  
  Подписывается на изменения состояния формы по указанным полям и вызывает callback с результатами валидации. Возвращает функцию для отписки.

  submit(): void  
  Валидирует и отправляет заказ. При ошибках валидации или отправки выводит предупреждения.

---
**BasketService**   
Сервис, управляющий корзиной товаров. Использует брокер событий StatefulEventEmitterService для хранения и трансляции состояния корзины

**Свойства**  
| Имя                            | Тип                           | Описание                                                                                         |
| ------------------------------ | ----------------------------- | ------------------------------------------------------------------------------------------------ |
| `_statefulEventEmitterService` | `StatefulEventEmitterService` | Сервис работы с кэшируемыми событиями. Используется для хранения и трансляции состояния корзины. |

**Методы**  

| Метод                        | Доступ    | Возвращает                    | Описание                                                                              |
| ---------------------------- | --------- | ----------------------------- | ------------------------------------------------------------------------------------- |
| `constructor(...)`           | `public`  | —                             | Инициализирует сервис и сбрасывает корзину до пустого массива.                        |
| `getAll()`                   | `public`  | `Product[]`                   | Получает текущий список товаров в корзине.                                            |
| `getById(id)`                | `public`  | `Product \| undefined`        | Находит и возвращает товар по ID, если он есть в корзине.                             |
| `getPriceBasket()`           | `public`  | `number`                      | Возвращает общую стоимость всех товаров (игнорирует `null`-цены).                     |
| `add(product)`               | `public`  | `void`                        | Добавляет товар в корзину (если его ещё нет) и эмитит обновлённое состояние.          |
| `remove(product)`            | `public`  | `void`                        | Удаляет товар из корзины и эмитит обновлённое состояние.                              |
| `onBasket(callback)`         | `public`  | `{ unsubscribe: () => void }` | Подписывает коллбек на обновления корзины. Возвращает объект с методом `unsubscribe`. |
| `onBasketById(id, callback)` | `public`  | `void`                        | Подписывает коллбек на добавление товара с указанным ID.                              |
| `offBasketById(id)`          | `public`  | `void`                        | Отписывает от всех событий добавления товара с указанным ID.                          |
| `clear()`                    | `public`  | `void`                        | Полностью очищает корзину.                                                            |
| `_offBasket(callback)`       | `private` | `void`                        | Отписывает переданный коллбек от событий изменения корзины.                           |
| `_setProducts(products)`     | `private` | `void`                        | Внутренний метод для задания состояния корзины (эмитит событие).                      |


---
**ComponentRegistryService**  
Сервис для регистрации компонентов и связи между экземплярами компонентов и DOM-элементами. Позволяет отслеживать регистрацию компонентов и получать их по DOM-узлам или инстансам.

**Свойства (приватные)**  
| Свойство      | Тип                                             | Описание                                                                     |
| ------------- | ----------------------------------------------- | ---------------------------------------------------------------------------- |
| `_byInstance` | `WeakMap<BaseComponent, ComponentRegistryInfo>` | Хранит связь между экземплярами компонентов и их регистрационной информацией |
| `_byElement`  | `WeakMap<HTMLElement, ComponentRegistryInfo>`   | Хранит связь между DOM-элементами и регистрационной информацией компонента   |
| `_listeners`  | `Map<string, Set<() => void>>`                  | Колбэки, ожидающие регистрацию компонента с определённым ID                  |

**Методы**  
| Метод                     | Аргументы                                         | Возвращает                           | Описание                                                                                                               |
| ------------------------- | ------------------------------------------------- | ------------------------------------ | ---------------------------------------------------------------------------------------------------------------------- |
| `register`                | `instance: BaseComponent`, `element: HTMLElement` | `void`                               | Регистрирует компонент и связывает его с DOM-элементом. Устанавливает `data-component-id`. Вызывает ожидающие колбэки. |
| `getByInstance`           | `instance: BaseComponent`                         | `ComponentRegistryInfo \| undefined` | Возвращает регистрационную информацию по инстансу компонента.                                                          |
| `getByElement`            | `element: HTMLElement`                            | `ComponentRegistryInfo \| undefined` | Возвращает регистрационную информацию по DOM-элементу.                                                                 |
| `onRegisteredByInstance`  | `instance: BaseComponent`, `callback: () => void` | `void`                               | Выполняет `callback`, если компонент уже зарегистрирован, иначе добавляет его в очередь ожидания регистрации.          |
| `_generateId` *(private)* | `instance: BaseComponent`                         | `string`                             | Генерирует уникальный ID для компонента на основе имени класса и `hashCode`.                                           |


**Типы, использующиеся в классе**  
```
type ComponentRegistryInfo = {
  instance: BaseComponent;
  element: HTMLElement;
  id: string;
};
```
BaseComponent и hashCode предполагаются определёнными извне — BaseComponent это базовый класс компонента, hashCode(instance) — функция генерации хэш-кода объекта.

---

**ModalService**  
Сервис управления модальными окнами: открытие, закрытие, отслеживание событий закрытия, поддержка как компонентов, так и обычных DOM-элементов.

**Свойства (приватные)**  

| Свойство                     | Тип                                                                                 | Описание                                                        |
| ---------------------------- | ----------------------------------------------------------------------------------- | --------------------------------------------------------------- |
| `_currentModal`              | `{ element: HTMLElement; component?: BaseComponent; onClose?: () => void } \| null` | Текущая активная модалка, если она открыта                      |
| `_onCloseListeners`          | `Map<HTMLElement, Set<() => void>>`                                                 | Постоянные колбэки, вызываемые при закрытии модалки             |
| `_pendingCloseListeners`     | `WeakMap<BaseComponent \| HTMLElement, Set<() => void>>`                            | Колбэки `onClose`, ожидающие открытия соответствующего контента |
| `_pendingCloseOnceListeners` | `WeakMap<BaseComponent \| HTMLElement, Set<() => void>>`                            | Одноразовые колбэки `onCloseOnce`, ожидающие открытия           |
| `_modalComponent`            | `ModalComponent`                                                                    | Компонент, отвечающий за визуализацию и анимацию модалки        |
| `_componentRegistryService`  | `ComponentRegistryService`                                                          | Сервис для получения DOM-элемента по компоненту и наоборот      |


**Методы**

| Метод                             | Аргументы                                                                                                              | Возвращает            | Описание                                                                                  |
| --------------------------------- | ---------------------------------------------------------------------------------------------------------------------- | --------------------- | ----------------------------------------------------------------------------------------- |
| `constructor`                     | `_modalComponent: ModalComponent`, `_componentRegistryService: ComponentRegistryService`                               | `ModalService`        | Создаёт экземпляр сервиса                                                                 |
| `open`                            | `content: BaseComponent \| HTMLElement`, `renderArgs?: any`, `options?: { onOpen?: () => void; onClose?: () => void }` | `void`                | Открывает модалку с указанным контентом. Закрывает предыдущую, если она открыта           |
| `close`                           | `content: BaseComponent \| HTMLElement`                                                                                | `void`                | Закрывает модалку, если она соответствует переданному контенту                            |
| `onClose`                         | `target: BaseComponent \| HTMLElement`, `callback: () => void`                                                         | `void`                | Добавляет постоянный обработчик, вызываемый при закрытии модалки                          |
| `onCloseOnce`                     | `target: BaseComponent \| HTMLElement`, `callback: () => void`                                                         | `void`                | Добавляет одноразовый обработчик, вызываемый при закрытии модалки                         |
| `_invokeRegularCloseCallbacks`    | `element: HTMLElement`                                                                                                 | `void`                | Внутренне вызывает все зарегистрированные onClose-колбэки                                 |
| `_handleModalClose`               | `modal: { element: HTMLElement; component?: BaseComponent; onClose?: () => void }`                                     | `void`                | Внутренне вызывает пользовательский `onClose`, если он задан                              |
| `_resolveElement`                 | `content: BaseComponent \| HTMLElement`, `renderArgs?: any`                                                            | `HTMLElement`         | Получает DOM-элемент из компонента (через `render`) или возвращает `HTMLElement` как есть |
| `_isComponent`                    | `obj: any`                                                                                                             | `boolean`             | Проверяет, является ли объект компонентом (имеет метод `render`)                          |
| `_getElementIfOpen`               | `content: BaseComponent \| HTMLElement`                                                                                | `HTMLElement \| null` | Возвращает DOM-элемент, если переданный контент — это текущая открытая модалка            |
| `_addPendingListener`             | `storage: WeakMap`, `target: BaseComponent \| HTMLElement`, `callback: () => void`                                     | `void`                | Вспомогательный метод для регистрации отложенного колбэка                                 |
| `_collectPendingRegularListeners` | `target: BaseComponent \| HTMLElement`                                                                                 | `() => void`\[]       | Забирает и удаляет отложенные `onClose`-колбэки                                           |
| `_collectPendingOnceListeners`    | `target: BaseComponent \| HTMLElement`                                                                                 | `() => void`\[]       | Забирает и удаляет отложенные `onCloseOnce`-колбэки                                       | |

Используемые типы
```
type ModalOptions = {
  onOpen?: () => void;
  onClose?: () => void;
};

type CurrentModal = {
  element: HTMLElement;
  component?: BaseComponent;
  onClose?: () => void;
};
```
---

**ProductsService**

Сервер-адаптер для работы с моделью продуктов на базе StatefulEventEmitterService

Основные обязанности:
- Загружает данные о продуктах через API.
- Передаёт данные в модель (StatefulEventEmitterService), которая хранит состояние и рассылает обновления.
- Обеспечивает подписку представления на реактивные изменения данных.
- Позволяет отписаться от обновлений, например, при размонтировании компонента.

**Свойства**

| Свойство                       | Тип                           | Описание                                                  |
| ------------------------------ | ----------------------------- | --------------------------------------------------------- |
| `_apiProductsService`          | `ApiProductsService`          | Сервис для загрузки данных продуктов с API                |
| `_statefulEventEmitterService` | `StatefulEventEmitterService` | Модель — сервис событий с хранением состояния и подпиской |

**Методы**

| Метод                 | Параметры                                                                                              | Возвращаемое значение | Описание                                                                                                 |
| --------------------- | ------------------------------------------------------------------------------------------------------ | --------------------- | -------------------------------------------------------------------------------------------------------- |
| `constructor`         | `_apiProductsService: ApiProductsService`, `_statefulEventEmitterService: StatefulEventEmitterService` | -                     | Инициализирует адаптер с сервисом API и моделью                                                          |
| `getAll`              | `callback: (products: Product[]) => void`, `onDestroy?: (unsubscribe: () => void) => void`             | `void`                | Загружает продукты, обновляет модель, подписывает callback на события обновления, с возможностью отписки |
| `_update` (приватный) | `products: Product[]`                                                                                  | `void`                | Эмитит событие обновления продуктов в модель                                                             |

---
**BaseComponent**  
Абстрактный базовый класс для всех компонентов. Предоставляет общую логику рендеринга через шаблон (template) и автоматическую регистрацию DOM-элемента в ComponentRegistryService.

**Свойства**  
| Свойство                    | Модификатор | Тип                        | Описание                                                    |
| --------------------------- | ----------- | -------------------------- | ----------------------------------------------------------- |
| `_template`                 | `protected` | `HTMLTemplateElement`      | Шаблон, на основе которого создаётся DOM-элемент компонента |
| `_componentRegistryService` | `private`   | `ComponentRegistryService` | Сервис для регистрации компонента в реестре                 |

**Методы**  
| Метод              | Модификатор | Аргументы                       | Возвращает                    | Описание                                                                                     |
| ------------------ | ----------- | ------------------------------- | ----------------------------- | -------------------------------------------------------------------------------------------- |
| `constructor`      | `public`    | `template: HTMLTemplateElement` | —                             | Инициализирует компонент с HTML-шаблоном и внедряет `ComponentRegistryService`               |
| `render`           | `abstract`  | `...args: any[]`                | `RegisteredElement<TElement>` | Абстрактный метод, реализуется в потомках. Возвращает отрендеренный и зарегистрированный DOM |
| `_cloneTemplate`   | `protected` | —                               | `RegisteredElement<TElement>` | Клонирует шаблон и регистрирует DOM-элемент                                                  |
| `_registerElement` | `protected` | `element: TElement`             | `RegisteredElement<TElement>` | Регистрирует DOM-элемент через `ComponentRegistryService` и возвращает его                   |

**Используемые типы и зависимости**  
`ComponentRegistryService` — сервис, регистрирующий соответствие между компонентами и DOM-элементами.

`cloneTemplate<T>()` — функция клонирования HTML-шаблона (предположительно импортируется извне).

`RegisteredElement<T>` — тип, который представляет DOM-элемент, зарегистрированный в реестре.

---
**CachedComponent**  
CachedComponent — абстрактный компонент, основанный на BaseComponent, который рендерит контент только один раз, а затем возвращает кэшированный DOM-элемент при повторных вызовах. Подходит для компонентов без повторного монтирования.

| Параметр   | Описание                                                               |
| ---------- | ---------------------------------------------------------------------- |
| `TCache`   | Тип объекта, используемого для хранения кэшированных данных компонента |
| `TElement` | Тип HTML-элемента, возвращаемого при рендере                           |

**Свойства**  
| Свойство         | Модификатор | Тип                           | Описание                                                                 |
| ---------------- | ----------- | ----------------------------- | ------------------------------------------------------------------------ |
| `_cachedData`    | `protected` | `TCache`                      | Кэшированные данные, инициализируемые один раз через `_initCachedData()` |
| `_cachedElement` | `protected` | `RegisteredElement<TElement>` | DOM-элемент, сгенерированный из шаблона и кэшированный                   |
| `_isRegistered`  | `private`   | `boolean`                     | Флаг: зарегистрирован ли DOM-элемент в `ComponentRegistryService`        |

**Методы**  
| Метод             | Модификатор          | Аргументы                       | Возвращает                    | Описание                                                                            |
| ----------------- | -------------------- | ------------------------------- | ----------------------------- | ----------------------------------------------------------------------------------- |
| `constructor`     | `public`             | `template: HTMLTemplateElement` | —                             | Инициализирует шаблон, кэширует элемент и данные, подключает DI-инит                |
| `render`          | `public`             | `...args: any[]`                | `RegisteredElement<TElement>` | Возвращает кэшированный элемент. Первый раз регистрирует его и вызывает `_update()` |
| `_initCachedData` | `protected abstract` | —                               | `TCache`                      | Абстрактный метод: должен вернуть структуру с кэшированными данными                 |
| `_update`         | `protected`          | `...args: any[]`                | `void`                        | Обновляет состояние или содержимое компонента. Переопределяется при необходимости   |
| `_afterInit`      | `protected`          | —                               | `void`                        | Метод, вызываемый один раз после внедрения зависимостей. Опционален                 |

---
**StatelessComponent**  
Абстрактный класс-компонент, расширяющий BaseComponent, не хранящий состояния. Предназначен для простых компонентов без внутреннего кэширования или логики обновления.

**Назначение**  
Используется для компонентов, которые не содержат состояния (state) и не нуждаются в кэшировании (render вызывается каждый раз заново).  
Подходит для простых UI-компонентов — кнопок, иконок, надписей и т.п.

**Унаследованные свойства от BaseComponent**  
| Свойство                    | Модификатор | Тип                        | Описание                                              |
| --------------------------- | ----------- | -------------------------- | ----------------------------------------------------- |
| `_template`                 | `protected` | `HTMLTemplateElement`      | HTML-шаблон, на основе которого создаётся DOM-элемент |
| `_componentRegistryService` | `private`   | `ComponentRegistryService` | Сервис регистрации компонента                         |

**Унаследованные методы от BaseComponent**  
| Метод                       | Модификатор | Возвращает                    | Описание                                                                            |
| --------------------------- | ----------- | ----------------------------- | ----------------------------------------------------------------------------------- |
| `render(...args)`           | `abstract`  | `RegisteredElement<TElement>` | Должен быть реализован в потомке. Возвращает отрендеренный и зарегистрированный DOM |
| `_cloneTemplate()`          | `protected` | `RegisteredElement<TElement>` | Клонирует шаблон и регистрирует его                                                 |
| `_registerElement(element)` | `protected` | `RegisteredElement<TElement>` | Регистрирует DOM-элемент в `ComponentRegistryService`                               |

---

**ModalComponent**

Компонент, управляющий отображением и поведением модального окна. Поддерживает программное и ручное закрытие, а также колбэки открытия и закрытия.

**Свойства (приватные)**

| Свойство                  | Тип           | Описание                                                          |
| ------------------------- | ------------- | ----------------------------------------------------------------- |
| `_modalContainerElement`  | `HTMLElement` | Контейнер модального окна (`#modal-container`)                    |
| `_modalContentElement`    | `HTMLElement` | Область, куда вставляется контент модалки                         |
| `_modalCloseElement`      | `HTMLElement` | Кнопка закрытия модалки (обычно крестик)                          |
| `_openCallback`           | `() => void`  | Колбэк, вызываемый при открытии                                   |
| `_closeCallback`          | `() => void`  | Колбэк, вызываемый при любом закрытии                             |
| `_closeOnceCallback`      | `() => void`  | Колбэк, вызываемый **только при ручном** закрытии                 |
| `_isOpen`                 | `boolean`     | Флаг: модалка открыта или нет                                     |
| `_pointerDownInsideModal` | `boolean`     | Был ли `pointerdown` внутри контента модалки                      |
| `_pointerUpInsideModal`   | `boolean`     | Был ли `pointerup` внутри контента модалки                        |
| `_isProgrammaticClose`    | `boolean`     | Флаг: идёт ли сейчас программное закрытие (а не пользовательское) ||

**Методы**

| Метод                    | Аргументы                                                               | Возвращает       | Описание                                                                                   |
| ------------------------ | ----------------------------------------------------------------------- | ---------------- | ------------------------------------------------------------------------------------------ |
| `constructor`            | –                                                                       | `ModalComponent` | Инициализирует DOM-ссылки на контейнер, контент и кнопку закрытия                          |
| `open`                   | `content: HTMLElement`, `options?: { onOpen?, onClose?, onCloseOnce? }` | `void`           | Открывает модалку с контентом. Добавляет колбэки, навешивает слушатели, добавляет классы   |
| `close`                  | –                                                                       | `void`           | Программно закрывает модалку, вызывает `onClose`, **не вызывает** `onCloseOnce`            |
| `_manualClose`           | –                                                                       | `void`           | Закрывает модалку вручную (по нажатию на крестик, оверлей или Esc). Вызывает `onCloseOnce` |
| `_initEventListeners`    | –                                                                       | `void`           | Вешает обработчики событий на DOM для закрытия по UI                                       |
| `_destroyEventListeners` | –                                                                       | `void`           | Удаляет все навешанные обработчики событий                                                 |
| `_onPointerDown`         | `event: PointerEvent`                                                   | `void`           | Обрабатывает событие pointerdown и запоминает, был ли клик внутри модалки                  |
| `_onPointerUp`           | `event: PointerEvent`                                                   | `void`           | Аналогично — для pointerup                                                                 |
| `_closeByOverlay`        | `event: MouseEvent`                                                     | `void`           | Закрывает модалку при клике на оверлей (вне модалки), если клик был полностью вне контента |
| `_closeByEsc`            | `event: KeyboardEvent`                                                  | `void`           | Закрывает модалку по нажатию клавиши `Escape`                                              |

---
**SuccessOrderComponent**

Компонент, отображающий сообщение об успешном оформлении заказа. Используется внутри модального окна и взаимодействует с сервисами заказа, корзины и модалок.

**Свойства**

| Свойство                        | Тип                              | Описание                                                            |
| ------------------------------- | -------------------------------- | ------------------------------------------------------------------- |
| `_modalService`                 | `ModalService`                   | Сервис управления модальными окнами                                 |
| `_cachedData` (унаследовано)    | `SuccessOrderData`               | Кэшированные элементы: корневой элемент, описание и кнопка закрытия |
| `_cachedElement` (унаследовано) | `RegisteredElement<HTMLElement>` | Основной DOM-элемент компонента                                     |


**Методы**

| Метод             | Аргументы                     | Возвращает         | Описание                                                                  |
| ----------------- | ----------------------------- | ------------------ | ------------------------------------------------------------------------- |
| `constructor`     | `_modalService: ModalService` | —                  | Инициализирует компонент, передаёт шаблон в `CachedComponent`             |
| `_initCachedData` | —                             | `SuccessOrderData` | Инициализирует и возвращает кэшированные DOM-элементы компонента          |
| `_afterInit`      | —                             | `void`             | Навешивает обработчик клика на кнопку закрытия, который закрывает модалку |
| `_update`         | `res: CreateOrderResponse`    | `void`             | Обновляет описание успешного заказа, отображая списанную сумму            |

---

**PaymentAddressOrderComponent**

Компонент формы выбора адреса доставки и способа оплаты (наличные или карта). Работает в реактивной архитектуре через StatefulEventEmitterService и OrderService

**Свойства**

| Имя             | Тип                       | Описание                                                                                               |
| --------------- | ------------------------- | ------------------------------------------------------------------------------------------------------ |
| `_orderService` | `OrderService`            | Сервис управления текущим заказом: содержит состояние формы, методы установки адреса и способа оплаты. |
| `_eventEmitter` | `EventEmitter`            | Сервис событий, используется для перехода к следующему шагу оформления (ввод e-mail и телефона).       |
| `_modalService` | `ModalService`            | Управляет открытием и закрытием модального окна       |
| `_cachedData`   | `PaymentAddressOrderData` | Кэш DOM-элементов формы: кнопки оплаты, поле адреса, кнопка отправки, блок ошибок и сама форма.        |


**Методы**

| Имя                                  | Доступ      | Возвращает                | Описание                                                                                                                               |
| ------------------------------------ | ----------- | ------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| `constructor(...)`                   | `public`    | —                         | Получает шаблон `#order`, передаёт его в родительский класс `CachedComponent`, инициализирует зависимости.                             |
| `_initCachedData()`                  | `protected` | `PaymentAddressOrderData` | Находит и кэширует все необходимые DOM-элементы формы: поля, кнопки, ошибки.                                                           |
| `_afterInit()`                       | `protected` | `void`                    | Устанавливает начальный способ оплаты, подписывает события (ввод адреса, клик по кнопкам, submit), слушает валидацию и закрытие формы. |
| `_setPaymentMethod(method)`          | `private`   | `void`                    | Устанавливает текущий способ оплаты в `OrderService` и обновляет стили кнопок.                                                         |
| `_updatePaymentButtonStyles(method)` | `private`   | `void`                    | Меняет классы активного состояния у кнопок оплаты в зависимости от текущего метода.                                                    |
| `_update()`                          | `protected` | `void`                    | Сброс формы при каждом новом рендере: очищает адрес, ошибки, сбрасывает способ оплаты и отключает кнопку отправки.                     |

---

**EmailPhoneOrderComponent**

Компонент формы ввода email и телефона при оформлении заказа. Обеспечивает реактивную валидацию и отправку данных через OrderService

**Свойства**

| Свойство                        | Тип                              | Описание                                                    |
| ------------------------------- | -------------------------------- | ----------------------------------------------------------- |
| `_orderService`                 | `OrderService`                   | Сервис управления состоянием заказа, валидацией и отправкой |
| `_modalService`                 | `ModalService`                   | Сервис управления модальными окнами                         |
| `_basketService`                | `BasketService`                  | Сервис управления корзиной                                  |
| `_cachedData` (унаследовано)    | `EmailPhoneOrderData`            | Кэшированные элементы формы: input, кнопка, блок ошибок     |
| `_cachedElement` (унаследовано) | `RegisteredElement<HTMLElement>` | Основной DOM-элемент формы, кэшируется при первом рендере   |
    |


**Методы**

| Метод             | Аргументы                                                                                     | Возвращает            | Описание                                                                                                                   |
| ----------------- | --------------------------------------------------------------------------------------------- | --------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| `constructor`     | `_orderService: OrderService`, `_modalService: ModalService`, `_basketService: BasketService` | —                     | Инициализирует компонент, передаёт шаблон в `CachedComponent`                                                              |
| `_initCachedData` | —                                                                                             | `EmailPhoneOrderData` | Создаёт и возвращает кэшированные элементы: поля ввода, кнопка, блок ошибок, динамические элементы ошибок                  |
| `_afterInit`      | —                                                                                             | `void`                | Навешивает обработчики ввода, подписывается на изменения состояния формы, обработчик сабмита и сброса при закрытии модалки |
| `_clearElements`  | —                                                                                             | `void`                | Очищает значения полей, состояние кнопки и содержимое сообщений об ошибках                                                 |
| `_update`         | —                                                                                             | `void`                | Переопределяет метод обновления компонента — вызывает очистку полей и ошибок                                               |

---

**CardFullComponent**

Компонент отображает подробную карточку товара, включая изображение, категорию, цену и кнопку добавления/удаления из корзины

**Свойства**

| Имя              | Тип             | Описание                                                                                                                     |
| ---------------- | --------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| `_basketService` | `BasketService` | Сервис управления корзиной — проверяет наличие товара, добавляет или удаляет его.                                            |
| `_cachedData`    | `CardFullData`  | Кэш DOM-элементов шаблона: категория, заголовок, изображение, цена, кнопка и сам продукт (наследуется от `CachedComponent`). |




**Методы**

| Имя                       | Доступ      | Возвращает     | Описание                                                                                                                              |
| ------------------------- | ----------- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| `constructor(...)`        | `public`    | —              | Выбирает шаблон `#card-preview`, передаёт его родительскому классу `CachedComponent`, сохраняет зависимости.                          |
| `_initCachedData()`       | `protected` | `CardFullData` | Инициализирует кэш: выбирает элементы DOM и сохраняет их, включая кнопку, заголовок, изображение и др.                                |
| `_afterInit()`            | `protected` | `void`         | Выполняется после инициализации: очищает CSS-классы категории и добавляет обработчик на кнопку «Купить / Удалить».                    |
| `_update(product)`        | `protected` | `void`         | Основной метод отрисовки данных карточки: заполняет содержимое DOM-элементов и настраивает кнопку в зависимости от состояния корзины. |
| `_renderBtnText(product)` | `private`   | `void`         | Логика смены текста и состояния кнопки: если товар уже в корзине — удаляет его, иначе — добавляет.                                    |

---

**BasketComponent**

Компонент отображает содержимое корзины, управляет рендером списка товаров, общей суммой и кнопкой оформления заказа. Реактивно обновляется при изменении корзины

**Свойства**

| Имя                    | Тип                   | Описание                                                                                                                             |
| ---------------------- | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `_basketService`       | `BasketService`       | Сервис управления корзиной. Предоставляет данные и методы для получения списка товаров и цены.                                       |
| `_basketCardComponent` | `BasketCardComponent` | Компонент для рендера отдельных карточек товаров в корзине.                                                                          |
| `_eventEmitter`        | `EventEmitter`        | Сервис событий. Используется для оповещения других компонентов (например, открытия формы заказа).                                    |
| `_cachedData`          | `BasketComponentData` | Кэшированные элементы DOM, полученные из шаблона: список товаров, цена, кнопка оформления и т.д. (наследуется от `CachedComponent`). |

<br>

**Методы**

| Имя                               | Доступ      | Возвращает            | Описание                                                                                                                   |
| --------------------------------- | ----------- | --------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| `constructor(...)`                | `public`    | —                     | Инициализирует компонент, выбирает шаблон `#basket`, передаёт его в родительский `CachedComponent`, сохраняет зависимости. |
| `_initCachedData()`               | `protected` | `BasketComponentData` | Вызывается родительским конструктором. Ищет и сохраняет важные DOM-элементы корзины.                                       |
| `_afterInit()`                    | `protected` | `void`                | Выполняется после инициализации. Подписывается на изменения корзины и добавляет обработчик на кнопку «Оформить заказ».     |
| `_appendBasketElements(products)` | `private`   | `void`                | Добавляет в DOM карточки всех продуктов из корзины, очищая и обновляя список.                                              |
| `_renderActionsInfo(priceBasket)` | `private`   | `void`                | Обновляет цену, состояние кнопки и отображение надписи «Корзина пуста», если в корзине нет товаров.                        |
| `_renderAll(products)`            | `private`   | `void`                | Главный метод рендера: вызывает методы обновления цены и отрисовки всех карточек.                                          |

---

**GalleryController**

Класс GalleryController предназначен для отображения списка товаров в галерее на странице. Он управляет отрисовкой карточек товаров, используя переданный компонент карточки каталога

**Методы**  
| Метод               | Аргументы                                     | Возвращает | Описание                                                             |
| ------------------- | --------------------------------------------- | ---------- | -------------------------------------------------------------------- |
| `constructor`       | `_cardCatalogComponent: CardCatalogComponent` | —          | Инициализирует компонент и находит элемент галереи в DOM             |
| `renderProductList` | `products: Product[]`                         | `void`     | Очищает галерею и добавляет карточки для каждого продукта из массива |

---

**CardCatalogComponent**

Класс CardCatalogComponent отвечает за создание карточек товаров для отображения в каталоге. Он инкапсулирует логику генерации карточки и обработки клика по ней.


**Методы**  

| Метод               | Аргументы                                                   | Возвращает          | Описание                                                                                |
| ------------------- | ----------------------------------------------------------- | ------------------- | --------------------------------------------------------------------------------------- |
| `constructor`       | `_eventEmitter: EventEmitter` | —                   | Инициализация компонента с указанием шаблона                                            |
| `render`            | `product: Product`                                          | `RegisteredElement` | Создаёт и возвращает DOM-элемент карточки, заполненный данными товара                   |
| `_cardCatalogClick` | `product: Product`                                          | `void`              | Обработчик клика по карточке — инициирует событие открытия полной информации о продукте |

---
**BasketHeaderController**  

Класс BasketHeaderController предназначен для отображения и обновления информации о корзине в шапке сайта. Также он обрабатывает клик по иконке корзины для открытия модального окна с её содержимым.

**Свойства**

| Свойство                       | Тип                                                          | Описание                                                            |
| ------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------------- |
| `_headerBasketElement`         | `HTMLElement`                                                | DOM-элемент корзины в шапке (`.header__basket`)                     |
| `_counterElement`              | `HTMLElement`                                                | DOM-элемент счётчика количества товаров (`.header__basket-counter`) |                                   |


**Методы**

| Метод                         | Аргументы                                                   | Возвращает | Описание                                                                                        |
| ----------------------------- | ----------------------------------------------------------- | ---------- | ----------------------------------------------------------------------------------------------- |
| `constructor`                 | `_eventEmitter: EventEmitter` | —          | Инициализирует элементы DOM и навешивает слушатели событий                                      |
| `setQuantityProductsInBasket` | `quantity: number`                                          | `void`     | Обновляет текстовое содержимое счётчика количества товаров в корзине                            |
| `_initEventListeners`         | —                                                           | `void`     | Навешивает обработчик клика на корзину, который вызывает событие `OPEN_CART` через EventEmitter |

---

**BasketCardComponent**

Класс BasketCardComponent отвечает за создание DOM-элемента карточки товара, отображаемой в корзине. Он инкапсулирует логику визуализации одного элемента списка корзины и обработку удаления товара.

**Свойства**
| Свойство                   | Тип                   | Описание                                                           |
| -------------------------- | --------------------- | ------------------------------------------------------------------ |
| `_basketService`           | `BasketService`       | Сервис управления корзиной товаров                                 |


**Методы**
| Метод            | Аргументы                         | Возвращает                         | Описание                                                                           |
| ---------------- | --------------------------------- | ---------------------------------- | ---------------------------------------------------------------------------------- |
| `constructor`    | `_basketService: BasketService`   | —                                  | Инициализирует компонент, передавая шаблон из DOM родительскому классу             |
| `render`         | `product: Product, index: number` | `RegisteredElement<HTMLLIElement>` | Создаёт и возвращает DOM-элемент карточки товара с заполненными данными            |
| `_deleteProduct` | `product: Product`                | `void`                             | Обработчик удаления товара: вызывает сервис корзины для удаления указанного товара |

---

**ValidationOrderService**

Сервис предназначен для валидации полей заказа. Используется для проверки обязательных данных: email, телефон, адрес. Предоставляет результат валидации и сообщения об ошибках

**Методы**

| Метод                          | Возвращает                                                           | Описание                                                                                                       |
| ------------------------------ | -------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------- |
| `validate(order, fields)`      | `{ isValid: boolean; errors: Partial<Record<keyof Order, string>> }` | Проверяет валидность указанных полей объекта `order`. Возвращает флаг валидности и объект с ошибками по полям. |
| `_validateField(field, value)` | `string \| null` **(private)**                                       | Проверяет одно поле заказа. Возвращает строку ошибки или `null`, если значение корректно.                      |


---

**DIContainer**

Класс DIContainer реализует простой механизм Dependency Injection (DI) с поддержкой singleton и transient областей жизненного цикла.

Позволяет регистрировать зависимости (провайдеры) и автоматически разрешать их с учётом указанного скоупа и вложенных зависимостей

**Свойства**

| Свойство      | Тип                       | Описание                                                                                    |
| ------------- | ------------------------- | ------------------------------------------------------------------------------------------- |
| `_registry`   | `Map<string, DIProvider>` | Реестр зарегистрированных провайдеров: хранит информацию о классах, зависимостях и скоупах. |
| `_singletons` | `Map<string, any>`        | Хранилище уже созданных singleton-экземпляров.                                              |

**Методы**

| Метод                           | Аргументы                                                                                                                                                     | Возвращает | Описание                                                                                                                                                                                         |
| ------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `register<T>(key, DIProvider?)` | - `key: DIConstructor<T>` – класс для регистрации<br>- `DIProvider?: Partial<DIProvider<T>>` – параметры регистрации (опционально: класс, зависимости, скоуп) | `void`     | Регистрирует класс и его зависимости. Проверяет соответствие числа зависимостей числу параметров конструктора. По умолчанию скоуп — `singleton`.                                                 |
| `resolve<T>(key)`               | - `key: string \| DIConstructor<T>` — имя класса или сам конструктор                                                                                          | `T`        | Создаёт и возвращает экземпляр. Повторно использует singleton-экземпляр, если указан `singleton`. Вложенные зависимости разрешаются автоматически. Бросает ошибку, если ключ не зарегистрирован. |

## Модели данных и типы:

### Типы и интерфейсы

**ProductCategory**  
Тип, определяющий возможные категории продукта

```
type ProductCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```
---

Интерфейс описывает товар:  
  id — уникальный идентификатор товара.  
  description — описание товара.  
  image — ссылка на изображение.  
  title — название.  
  category — категория (тип ProductCategory).  
  price — цена товара или null, если товар недоступен для покупки.

```
interface Product {
  id: string;
  description: string;
  image: string;
  title: string;
  category: ProductCategory;
  price: number | null;
}
```

---

**Payment**

```
type Payment = 'online' | 'offline';
```

Тип метода оплаты:  
  'online' — онлайн-оплата,  
  'offline' — оплата при получении

---

**CreateOrderRequest**

```
interface CreateOrderRequest {
  payment: Payment;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Интерфейс для отправки заказа:  
  payment — способ оплаты.  
  email — адрес электронной почты покупателя.  
  phone — номер телефона.  
  address — адрес доставки.  
  total — итоговая сумма заказа.
  items — массив id товаров в заказе

---

**CreateOrderResponse**

```
interface CreateOrderResponse {
  id: string;
  total: number;
}
```

Ответ сервера на создание заказа:
  id — идентификатор созданного заказа.
  total — подтверждённая сумма

---

**GetAllProductsResponse**

```
interface GetAllProductsResponse {
  total: number;
  items: Product[];
}
```

Ответ API при получении списка продуктов:  
  total — общее количество товаров.  
  items — массив объектов типа Product

---

**Order**

```
interface Order {
  payment: Payment;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Полное представление заказа в приложении (аналог CreateOrderRequest), может использоваться локально.

---
**ComponentRegistryInfo**  
Интерфейс, описывающий регистрационную информацию о компоненте, зарегистрированном в ComponentRegistryService.  
Используется для хранения связи между компонентом и его DOM-элементом, а также для идентификации.  
Этот интерфейс играет ключевую роль в ComponentRegistryService, обеспечивая доступ к компоненту как по экземпляру, так и по DOM-элементу.

**Свойства**  
| Свойство   | Тип             | Описание                                                                |
| ---------- | --------------- | ----------------------------------------------------------------------- |
| `instance` | `BaseComponent` | Экземпляр компонента, реализующего `BaseComponent`                      |
| `element`  | `HTMLElement`   | DOM-элемент, сгенерированный компонентом и зарегистрированный в реестре |
| `id`       | `string`        | Уникальный идентификатор компонента, используемый для отслеживания      |

---
**RegisteredElement**  
Тип-обёртка над стандартным HTMLElement, используемый для обозначения DOM-элементов, зарегистрированных в ComponentRegistryService.

**Назначение**  
Обеспечивает типовую безопасность: помогает отличать обычные DOM-элементы от тех, которые прошли регистрацию в ComponentRegistryService.  
Используется внутри компонентов, чтобы гарантировать, что элемент был создан и зарегистрирован корректно.

**Свойства**  
| Свойство            | Тип    | Описание                                                                                  |
| ------------------- | ------ | ----------------------------------------------------------------------------------------- |
| Все свойства `T`    | `T`    | Все стандартные свойства переданного типа `HTMLElement` (например, `div`, `span` и т. д.) |
| `__registeredBrand` | `true` | Специальный "бренд" (маркер), помечающий элемент как прошедший регистрацию                |

---
**Перечисление EventNames**  

| Название события             | Значение                       | Описание                                                                                                 |
| ---------------------------- | ------------------------------ | -------------------------------------------------------------------------------------------------------- |
| `OPEN_CARD_FULL`             | `'open-card-full'`             | Открытие модального окна с полной карточкой товара                                 |
| `BASKET_CHANGED`             | `'basket-changed'`             | Обновление содержимого корзины. Происходит при удалении/добавлении товара в корзину |
| `OPEN_BASKET`                  | `'open-basket'`                  | Открытие модального окна с корзиной                                                          |
| `OPEN_ORDER_ADDRESS_PAYMENT` | `'open-order-address-payment'` | Открытие шага оформления заказа: адрес доставки и выбор способа оплаты.                                  |
| `OPEN_ORDER_EMAIL_PHONE`     | `'open-order-email-phone'`     | Открытие шага оформления заказа: ввод email и телефона.                                                  |
| `OPEN_SUCCESS_ORDER`         | `'open-success-order'`         | Открытие модального окна с успешно выполненным заказом.                                                       |
| `ORDER_CHANGED`              | `'order-changed'`              | Изменение состояния заказа       |
| `PRODUCTS_CHANGED`           | `'products-changed'`           | Обновление списка товаров, отображаемых в галерее    |

Перечисление ключевых событий в приложении. Используется для взаимодействия между компонентами через событийную систему

---

**Объект сопоставления categoryCompareObj**

```
const categoryCompareObj = {
  'софт-скил': 'soft',
  'дополнительное': 'additional',
  'другое': 'other',
  'кнопка': 'button',
  'хард-скил': 'hard'
};
```

Объект, сопоставляющий внутренние категории (ProductCategory). Используется для задания CSS классов для категорий в карточках товаров.


---

## Типы для DI контейнера

Конструктор, который может быть вызван с любыми аргументами и создаёт объект типа T
```
type DIConstructor<T = any> = new (...args: any[]) => T;
```

---

Область жизненного цикла:  
- 'singleton' — один экземпляр на контейнер;
- 'transient' — каждый вызов создает новый экземпляр

```
type DIScope = 'singleton' | 'transient';
```

---

Провайдер описывает, как создать и зарегистрировать класс в контейнере
```
interface DIProvider<T = any> {
  useClass: DIConstructor<T>;
  deps?: (string | DIConstructor)[];
  scope?: DIScope;
}
```
| Свойство   | Тип                | Описание                                    |                                                 |
| ---------- | ------------------ | ------------------------------------------- | ----------------------------------------------- |
| `useClass` | `DIConstructor<T>` | Класс, создаваемый контейнером              |                                                 |
| `deps`     | string или DIConstructor)[]                                   | Массив зависимостей, передаваемых в конструктор |
| `scope`    | `DIScope`          | Жизненный цикл (по умолчанию `'singleton'`) |                                                 |


---

Интерфейс для классов, которые могут использоваться в DI. Поле inject содержит массив зависимостей, которые необходимо внедрить в конструктор

```
interface DIInjectable<T = any> {
  new (...args: any[]): T;
  inject?: DIConstructor<any>[];
}
```
**inject**  
Функция inject используется для получения (разрешения) зависимости из глобального DI-контейнера.

| Аргумент | Тип                          | Описание                                                                |
| -------- | ---------------------------- | ----------------------------------------------------------------------- |
| `key`    | `DIConstructor<T> \| string` | Класс или строковое имя зависимости, зарегистрированной в DI-контейнере |

| Возвращает | Тип | Описание              |
| ---------- | --- | --------------------- |
| `T`        | —   | Экземпляр зависимости |

| Особенности                                                                |
| -------------------------------------------------------------------------- |
| Делегирует вызов в `container.resolve(...)`                                |
| Возвращает singleton или transient экземпляр в зависимости от конфигурации |
---
**DI_INIT**

DI_INIT — это уникальный символ, используемый как "хук инициализации" внутри DI-контейнера. Если класс содержит метод под ключом DI_INIT, этот метод будет автоматически вызван после создания экземпляра, когда все зависимости уже внедрены.

| Свойство  | Тип      | Значение            | Описание                                                                  |
| --------- | -------- | ------------------- | ------------------------------------------------------------------------- |
| `DI_INIT` | `symbol` | `Symbol('di_init')` | Специальный символ, распознаваемый DI-контейнером как метод инициализации |

**Назначение**  
| Назначение                | Пример                                       |
| ------------------------- | -------------------------------------------- |
| Пост-инициализация        | Настройка после внедрения зависимостей       |
| Отложенное подключение    | Подписка на события, инициализация состояния |
| Жизненный цикл компонента | Поддержка hook-подобного поведения           |
