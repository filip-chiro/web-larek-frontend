# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с TS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

- src/components/base - базовые классы, от Яндекс Практикума
- src/components/features - функциональные классы, которые реализуют определённые фичи
- src/services - сервисы, в которые выносится логика


### Общий стиль проекта

Архитектура проекта построена по принципам MVVM с EventEmitter-реактивностью, где:

- View отвечает только за отображение и взаимодействие с пользователем
- Model содержит бизнес-логику, API-запросы и валидацию
- ViewModel реализован через OrderService, BasketService, который не хранит состояние, а только управляет событиями (через StatefulEventEmitterService), действуя как посредник между представлением и моделью

При этом реализована строгая декомпозиция, аналогичная MVP:
- Все DOM-элементы кэшируются и не ищутся повторно
- Представление не знает ни о данных, ни о правилах валидации
- Логика бизнес-правил и отправки запроса находится в модели
- Коммуникация между слоями — через событийную систему (StatefulEventEmitterService)

**View (Компоненты)**

- Все компоненты реализуют интерфейс Component, в котором основным методом является render(), возвращающий HTMLElement
- DOM-элементы получаются один раз при создании экземпляра компонента, из шаблонов (`<template>`)
- В обработчиках событий (input, submit) компоненты не хранят данные, а передают их в OrderService (ViewModel)
- Подписка на изменения состояния происходит через onFormStateChange(), который обновляет UI при изменении валидности формы
- Примеры: EmailPhoneOrderComponent, PaymentAddressOrderComponent, BasketComponent

**Model (Сервисы)**

- ValidationOrderService: отвечает за валидацию формы. Валидация производится в момент изменения input, а не при отправке формы
- ApiOrderService и ApiProductsService: инкапсулируют запросы к API, не связаны напрямую с интерфейсом
- BasketService: модель состояния корзины, управляет данными о продуктах
- Ни один из сервисов не взаимодействует с DOM

**ViewModel (OrderService, BasketService, StatefulEventEmitterService)**

- OrderService как и BasketService не хранит локального состояния. Вместо этого, он агрегирует данные формы, передавая их через StatefulEventEmitterService и получает их обратно
- В OrderService реализованы методы:
- - updateEmail, updatePhone, setAddress, setPaymentMethod — обновляют поля формы
- - onFormStateChange — подписка на изменения валидации, возвращает валидность формы и ошибки
- - submit — валидирует и отправляет форму. Если есть ошибки — выводит предупреждение
- StatefulEventEmitterService служит как хранилище последнего состояния и event bus

**Поток данных (пример: EmailPhone форма)**

- Пользователь вводит email или телефон → EmailPhoneOrderComponent вызывает OrderService.updateEmail() / updatePhone().
- OrderService через StatefulEventEmitterService эмитит новое значение заказа (ORDER_CHANGED).
- Через подписку onFormStateChange() данные валидируются моделью (ValidationOrderService), и обратно прокидываются в компонент (isValid, errors).
- Компонент обновляет UI: отображает ошибки и активирует кнопку отправки.
- При сабмите вызывается OrderService.submit() — отправляется запрос, после чего открывается SuccessOrderComponent

**Принципы и требования — чеклист**

| Требование                              | Подробности                                                             |
| --------------------------------------- | ----------------------------------------------------------------------- |
| Каждый класс выполняет одну задачу      | `OrderService` — ViewModel, `ValidationOrderService` — только валидация |
| Компоненты не валидируют данные         | Вся логика в `ValidationOrderService`                                   |
| Компоненты не хранят данные             | Только `OrderService` агрегирует                                        |
| Повторный поиск DOM — отсутствует       | Все элементы берутся из шаблона один раз                                |
| Подписки снимаются при закрытии         | this._modalService.onClose + отписка                                                 |
| Повторяющийся код — выделен             | `cloneTemplate`, `renderAll`, `onFormStateChange` и т.д.                |
| API не вызывается из компонента         | Вызов через `OrderService.submit()`                                     |
| Модель обновляется при input, не submit | `inputEmail.addEventListener(...)`                                      |


**Почему MVVM, а не MVP?**

В классическом MVP презентер является координатором и сам вызывает обновления View. В данной архитектуре View и Model соединены через реактивную событийную модель. Это ближе к MVVM, где ViewModel (OrderService, BasketService) принимает команды и эмитит состояние, а View подписывается и обновляется

В данном случае архитектура ближе к MVP по ответственности классов, но реализована реактивно: через ViewModel-образный сервис (OrderService), который не содержит состояния, но управляет реактивной моделью формы. Это упрощает тестирование, уменьшает связанность и соответствует SRP

**Заключение**

Структура кода строго разделена на:
- Компоненты отображения (Component)
- Сервисы состояния и логики (Service)
- Вспомогательные утилиты

Основной акцент сделан на реактивной валидации формы, минимальной связанности между слоями, отказе от прямой работы с DOM в бизнес-логике. Все изменения модели производятся при input, а не при submit. Код полностью соответствует требованиям MVP с современными улучшениями из MVVM-подхода

## **Использование DI (Dependency Injection)**

**Зачем нужен DI в проекте**

В проекте реализован контейнер зависимостей (registerDependencies()), обеспечивающий инверсию управления (IoC). Это означает, что классы не создают свои зависимости напрямую, а получают их извне — через конструктор

основные проблемы, которые решает DI:

| Проблема                             | Как решает DI                                                                       |
| ------------------------------------ | ----------------------------------------------------------------------------------- |
| Жёсткая связанность между модулями   | Компоненты не создают зависимости напрямую, а получают их от контейнера             |
| Сложность тестирования и мокирования | Любой сервис можно заменить на подделку при тестах                                  |
| Проблемы порядка инициализации       | Все зависимости явно зарегистрированы и разрешаются в нужном порядке                |
| Скрытые зависимости                  | Благодаря `deps` явно указано, что нужно каждому классу                             |
| Повторное использование              | Один и тот же сервис можно передавать разным компонентам (например, `OrderService`) |
| Централизованная точка конфигурации  | Все зависимости описаны в одном месте — `registerDependencies()`                    |

<br><br>
Как это выглядит:

```
container.register(OrderService, {
  deps: [StatefulEventEmitterService, ValidationOrderService, ApiOrderService, BasketService]
});
```

Этот код указывает, что OrderService не создает свои зависимости сам, а полагается на контейнер, который их предоставит. Благодаря этому:
- Появляется явная структура зависимостей
- Упрощается масштабирование проекта
- Классы становятся легче для повторного использования

Все зависимости между слоями реализованы через контейнер зависимостей — это позволяет строго контролировать структуру, избежать дублирования и повысить масштабируемость. Компоненты не создают сервисы сами, а получают нужные зависимости через конструктор, что соответствует принципам инверсии управления (IoC) и единственной ответственности (SRP)

**Итог: зачем DI**

В кратком виде:
- Делает архитектуру явной и масштабируемой
- Облегчает тестирование
- Соответствует принципам SOLID
- Удовлетворяет формулировке задания: «взаимодействие между классами реализуется вне самих классов»
- Разгружает классы от ответственности по созданию зависимостей

---

Описание всех классов:

`ApiService` — базовый сервисный класс для работы с API. Он наследуется от класса `Api`, автоматически устанавливая базовый URL для всех HTTP-запросов. Используется как промежуточный слой, чтобы избежать повторяющегося указания базового URL в каждом конкретном API-сервисе. Не имеет своих методов, только наследует методы от `Api`

---

`ApiProductsService` - cервисный класс для взаимодействия с продуктами через API. Наследуется от ApiService

getAll(): `Promise<Product[]>`
  Выполняет GET-запрос к '/product'.
  Возвращает массив объектов Product, полученных из поля items ответа

getById(id: string): `Promise<Product>`
  Выполняет GET-запрос к '/product/{id}'.
  Возвращает объект Product по его идентификатору.

---

`ApiOrderService` - cервисный класс для отправки заказов на сервер. Наследуется от ApiService

send(createOrderRequest: CreateOrderRequest): `Promise<CreateOrderResponse>`
  Выполняет POST-запрос к '/order', отправляя данные заказа.
  Принимает объект createOrderRequest, содержащий информацию о заказе.
  Возвращает промис с объектом ответа CreateOrderResponse

---

**StatefulEventEmitterService** 
расширение EventEmitter, которое запоминает последнее значение каждого события. Позволяет:
- немедленно получить последнее значение события при подписке;
- реактивно подписываться на изменения состояния;
- централизованно управлять и очищать кэшированные значения.

**Свойства**

| Свойство      | Тип                | Описание                                                                                                                             |
| ------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------ |
| `_lastValues` | `Map<string, any>` | Хранит последние значения по каждому имени события. Используется для моментального ответа при подписке или ожидании через `waitFor`. |

**Методы**

| Метод                               | Аргументы                                                              | Возвращает       | Описание                                                                                                                                       |
| ----------------------------------- | ---------------------------------------------------------------------- | ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| `emit<T>(eventName, data?)`         | `eventName: string`<br>`data?: T`                                      | `void`           | Переопределяет базовый `emit`, сохраняя последнее значение события перед его распространением.                                                 |
| `on<T>(eventName, callback)`        | `eventName: EventName`<br>`callback: (data: T) => void`                | `void`           | Подписывает на событие и немедленно вызывает обработчик с последним сохранённым значением (если есть).                                         |
| `offAllByEventName(eventName)`      | `eventName: EventName`                                                 | `void`           | Удаляет всех слушателей события и очищает его кэшированное значение.                                                                           |
| `getLast<T>(eventName)`             | `eventName: string`                                                    | `T \| undefined` | Возвращает последнее значение события, если оно было сохранено.                                                                                |
| `clearLast(eventName?)`             | `eventName?: string`                                                   | `void`           | Очищает последнее значение одного события или всех событий, если аргумент не передан.                                                          |

---

`OrderService` - cервис, инкапсулирующий бизнес-логику создания и отправки заказа. Работает через брокер событий `StatefulEventEmitterService` и API-клиент `ApiOrderService`

**Зависимости**
- StatefulEventEmitterService — управление состоянием и событиями заказа.
- ValidationOrderService — валидация данных заказа.
- ApiOrderService — отправка заказа на сервер.
- BasketService — получение информации о товарах в корзине

**Методы**  
**Приватные**

  _emitOrderUpdate(partialOrder: `Partial<Order>`): void  
  Обновляет и эмитит новое состояние заказа.

  _getCurrentOrder(): `Partial<Order> `  
  Получает текущее состояние заказа.

**Публичные**

  updateEmail(email: string): void  
  Обновляет email в заказе.

  updatePhone(phone: string): void  
  Обновляет телефон в заказе.

  setAddress(address: string): void  
  Устанавливает адрес доставки.

  setPaymentMethod(payment: Payment): void  
  Устанавливает метод оплаты.

  clear(): void  
  Очищает текущее состояние заказа.

  onFormStateChange(fields: `(keyof Order)[]`, callback: (state: `{ isValid: boolean; errors: Partial<Record<keyof Order, string>> }) => void`): `() => void`  
  Подписывается на изменения состояния формы по указанным полям и вызывает callback с результатами валидации. Возвращает функцию для отписки.

  submit(): void  
  Валидирует и отправляет заказ. При ошибках валидации или отправки выводит предупреждения.

---
`BasketService` - cервис, управляющий корзиной товаров. Использует брокер событий StatefulEventEmitterService для хранения и трансляции состояния корзины

getAll(): Product[]  
    Возвращает список всех товаров в корзине.
    Если данные отсутствуют — возвращает пустой массив.

getById(id: string): Product | undefined  
    Ищет товар по ID в текущем состоянии корзины.
    Возвращает найденный товар или undefined, если такого нет.

getPriceBasket(): number  
    Считает и возвращает общую стоимость всех товаров в корзине.

add(product: Product): void  
    Добавляет товар в корзину, если он ещё не добавлен.
    Эмитирует события:
        add-card-to-basket-{id} — добавление конкретного товара.
        remove-card-to-basket-{id} — удаление соответствующих подписчиков.
        BASKET — обновлённое состояние корзины.

remove(product: Product): void  
    Удаляет товар из корзины по ID.
    Эмитирует события:
        remove-card-to-basket-{id} — факт удаления товара.
        BASKET — обновлённое состояние корзины.

onBasket(callback: (products: Product[]) => void): void  
    Подписывает переданный callback на изменения в корзине (EventNames.BASKET).

offBasket(callback: (products: Product[]) => void): void  
    Удаляет переданный callback из подписки на изменения корзины.

onBasketById(id: string, callback: (product: Product) => void): void  
    Подписывает обработчик на событие добавления конкретного товара по ID.

offBasketById(id: string): void  
    Удаляет все подписки, связанные с добавлением конкретного товара по ID.

clear(): void  
    Полностью очищает корзину, эмитируя пустой список товаров в EventNames.BASKET

---

**ModalComponent**

Класс ModalComponent реализует модальное окно с поддержкой закрытия по крестику, клику вне контента и клавише Escape. Предназначен для управления отображением произвольного DOM-содержимого

**Свойства**

| Свойство                  | Тип           | Описание                                                                      |
| ------------------------- | ------------- | ----------------------------------------------------------------------------- |
| `_modalContainerElement`  | `HTMLElement` | Контейнер модального окна (`#modal-container`).                               |
| `_modalContentElement`    | `HTMLElement` | Элемент внутри контейнера для вставки основного контента (`.modal__content`). |
| `_modalCloseElement`      | `HTMLElement` | Кнопка закрытия модального окна (`.modal__close`).                            |
| `_openCallback`           | `() => void`  | Колбэк, вызываемый при открытии окна.                                         |
| `_closeCallback`          | `() => void`  | Колбэк, вызываемый при закрытии окна.                                         |
| `_isOpen`                 | `boolean`     | Флаг: открыто ли сейчас модальное окно.                                       |
| `_pointerDownInsideModal` | `boolean`     | Отслеживает, начался ли клик внутри контента модалки.                         |
| `_pointerUpInsideModal`   | `boolean`     | Отслеживает, закончился ли клик внутри контента модалки.                      |

**Методы**

| Метод                      | Возвращаемое значение | Описание                                                                                                                                                      |
| -------------------------- | --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `constructor()`            | `void`                | Инициализирует ссылку на DOM-элементы модального окна.                                                                                                        |
| `open(content, options?)`  | `void`                | Открывает модальное окно с переданным DOM-элементом `content`. Поддерживает колбэки `onOpen`, `onClose`. Если окно уже открыто — просто обновляет содержимое. |
| `close()`                  | `void`                | Закрывает модальное окно, снимает обработчики событий и вызывает `onClose`, если задан.                                                                       |
| `_initEventListeners()`    | `void`                | **(private)** Устанавливает все необходимые обработчики событий для управления модалкой.                                                                      |
| `_destroyEventListeners()` | `void`                | **(private)** Удаляет все ранее установленные обработчики событий.                                                                                            |
| `_onPointerDown(event)`    | `void`                | **(private)** Проверяет, был ли клик начат внутри модального контента.                                                                                        |
| `_onPointerUp(event)`      | `void`                | **(private)** Проверяет, был ли клик завершён внутри модального контента.                                                                                     |
| `_closeByOverlay(event)`   | `void`                | **(private)** Закрывает модалку по клику по оверлею (фону), если клик не был внутри модального контента.                                                      |
| `_closeByEsc(event)`       | `void`                | **(private)** Закрывает модалку при нажатии клавиши Escape.                                                                                                   |


---

**ModalService**

Сервис для управления модальными окнами. Отвечает за открытие и закрытие модалок, подписку на события закрытия, а также за реактивное поведение — позволяет отслеживать как обычные события закрытия

**Свойства**

| Имя                     | Тип                                                                             | Описание                                                                                           |
| ----------------------- | ------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
| `_currentModal`         | `{ element: HTMLElement; component?: Component; onClose?: () => void } \| null` | Текущее открытое модальное окно, если оно есть. Используется для отслеживания текущего состояния.  |
| `_onCloseListeners`     | `Map<HTMLElement, Set<() => void>>`                                             | Колбэки, вызываемые при **любом закрытии** модалки, связанной с элементом.                         |
| `_onCloseOnceListeners` | `Map<HTMLElement, Set<() => void>>`                                             | Колбэки, вызываемые **только если модалка была заменена новым компонентом**, а не вручную закрыта. |
| `_modalComponent`       | `ModalComponent`                                                                | Компонент, ответственный за визуальное отображение модального окна. Передаётся через конструктор.  |

**Методы**

| Метод                                   | Возвращаемое значение | Описание                                                                                                         |
| --------------------------------------- | --------------------- | ---------------------------------------------------------------------------------------------------------------- |
| `constructor(modalComponent)`           | `ModalService`        | Создаёт новый экземпляр сервиса, принимая компонент, управляющий DOM-модалкой.                                   |
| `open(content, renderArgs?, options?)`  | `void`                | Открывает модалку с компонентом или DOM-элементом. Закрывает предыдущее окно, если оно было открыто.             |
| `close(content)`                        | `void`                | Закрывает модалку, если она соответствует переданному компоненту или элементу.                                   |
| `onClose(target, callback)`             | `void`                | Регистрирует колбэк, который будет вызван при **любом закрытии** модалки, связанной с этим элементом.            |
| `onCloseOnce(target, callback)`         | `void`                | Регистрирует колбэк, вызываемый **только при замене модалки другим компонентом**, а не при обычном закрытии.     |
| `_resolveElement(content, renderArgs?)` | `HTMLElement`         | Вспомогательный метод: получает DOM-элемент из компонента (через `.render()`) или возвращает переданный элемент. |
| `_invokeAllCloseCallbacks(element)`     | `void`                | Вызывает все зарегистрированные колбэки `onClose` и `onCloseOnce` для указанного элемента.                       |
| `_handleModalClose(modal)`              | `void`                | Вызывает `onClose()` компонента и колбэк, переданный при `open()`.                                               |
| `_isComponent(obj)`                     | `boolean`             | Проверяет, является ли объект компонентом (имеет метод `render()`).                                              |

---

**ProductsService**

Сервер-адаптер для работы с моделью продуктов на базе StatefulEventEmitterService

Основные обязанности:
- Загружает данные о продуктах через API.
- Передаёт данные в модель (StatefulEventEmitterService), которая хранит состояние и рассылает обновления.
- Обеспечивает подписку представления на реактивные изменения данных.
- Позволяет отписаться от обновлений, например, при размонтировании компонента.

**Свойства**

| Свойство                       | Тип                           | Описание                                                  |
| ------------------------------ | ----------------------------- | --------------------------------------------------------- |
| `_apiProductsService`          | `ApiProductsService`          | Сервис для загрузки данных продуктов с API                |
| `_statefulEventEmitterService` | `StatefulEventEmitterService` | Модель — сервис событий с хранением состояния и подпиской |

**Методы**

| Метод                 | Параметры                                                                                              | Возвращаемое значение | Описание                                                                                                 |
| --------------------- | ------------------------------------------------------------------------------------------------------ | --------------------- | -------------------------------------------------------------------------------------------------------- |
| `constructor`         | `_apiProductsService: ApiProductsService`, `_statefulEventEmitterService: StatefulEventEmitterService` | -                     | Инициализирует адаптер с сервисом API и моделью                                                          |
| `getAll`              | `callback: (products: Product[]) => void`, `onDestroy?: (unsubscribe: () => void) => void`             | `void`                | Загружает продукты, обновляет модель, подписывает callback на события обновления, с возможностью отписки |
| `_update` (приватный) | `products: Product[]`                                                                                  | `void`                | Эмитит событие обновления продуктов в модель                                                             |

---

**SuccessOrderComponent**

Компонент, отображающий сообщение об успешном оформлении заказа. Используется внутри модального окна и взаимодействует с сервисами заказа, корзины и модалок.

**Свойства**

| Свойство                | Тип                   | Описание                                               |
| ----------------------- | --------------------- | ------------------------------------------------------ |
| `_successOrderTemplate` | `HTMLTemplateElement` | Ссылка на шаблон успешного заказа из DOM (`#success`). |
| `_basketService`        | `BasketService`       | Сервис для работы с корзиной.                          |
| `_orderService`         | `OrderService`        | Сервис для работы с заказом.                           |
| `_modalService`         | `ModalService`        | Сервис для управления модальными окнами.               |

**Методы**

| Метод                      | Возвращаемое значение | Описание                                                                            |
| -------------------------- | --------------------- | ----------------------------------------------------------------------------------- |
| `constructor(...)`         | `void`                | Инициализирует компонент, получает необходимые сервисы и шаблон DOM.                |
| `render()`                 | `HTMLElement`         | Рендерит сообщение об успехе с финальной стоимостью. Добавляет обработчик закрытия. |
| `_handleClose()` (private) | `void`                | Очищает корзину и заказ при закрытии модального окна.                               |



---

**PaymentAddressOrderComponent**

Компонент формы выбора адреса доставки и способа оплаты (наличные или карта). Работает в реактивной архитектуре через StatefulEventEmitterService и OrderService

**Свойства**

| Свойство                       | Тип                           | Описание                                               |
| ------------------------------ | ----------------------------- | ------------------------------------------------------ |
| `_template`                    | `HTMLTemplateElement`         | Шаблон формы заказа (`#order`) из DOM.                 |
| `_orderService`                | `OrderService`                | Сервис управления состоянием заказа.                   |
| `_statefulEventEmitterService` | `StatefulEventEmitterService` | Сервис событий с хранением последнего значения.        |
| `_modalService`                | `ModalService`                | Сервис для управления жизненным циклом модальных окон. |


**Методы**

| Метод                             | Возвращаемое значение | Описание                                                                                                              |
| --------------------------------- | --------------------- | --------------------------------------------------------------------------------------------------------------------- |
| `constructor(...)`                | `void`                | Инициализирует компонент, получает зависимости и DOM-шаблон.                                                          |
| `render()`                        | `HTMLElement`         | Рендерит форму с полем ввода адреса и кнопками выбора оплаты. Настраивает валидацию и поведение при закрытии модалки. |
| `_updatePaymentButtonStyles(...)` | `void`                | **(private)** Меняет активный стиль кнопки в зависимости от выбранного метода оплаты.                                 |
| `_setPaymentMethod(...)`          | `void`                | **(private)** Устанавливает способ оплаты в модель и обновляет визуальный стиль кнопок.                               |

---

**EmailPhoneOrderComponent**

Компонент формы ввода email и телефона при оформлении заказа. Обеспечивает реактивную валидацию и отправку данных через OrderService

**Свойства**

| Свойство        | Тип                   | Описание                                                 |
| --------------- | --------------------- | -------------------------------------------------------- |
| `_template`     | `HTMLTemplateElement` | DOM-шаблон формы (`#contacts`).                          |
| `_orderService` | `OrderService`        | Сервис работы с заказом (управление и валидация данных). |
| `_modalService` | `ModalService`        | Сервис управления жизненным циклом модальных окон.       |


**Методы**

| Метод              | Возвращаемое значение | Описание                                                                              |
| ------------------ | --------------------- | ------------------------------------------------------------------------------------- |
| `constructor(...)` | `void`                | Инициализирует компонент и загружает шаблон формы из DOM.                             |
| `render()`         | `HTMLElement`         | Рендерит форму, настраивает ввод, реактивную валидацию, отправку и очистку состояния. |


---

**CardFullComponent**

Компонент отображает подробную карточку товара, включая изображение, категорию, цену и кнопку добавления/удаления из корзины

**Свойства**

| Свойство         | Тип                   | Описание                                      |
| ---------------- | --------------------- | --------------------------------------------- |
| `_template`      | `HTMLTemplateElement` | DOM-шаблон карточки товара (`#card-preview`). |
| `_basketService` | `BasketService`       | Сервис для управления товарами в корзине.     |


**Методы**

| Метод                  | Возвращаемое значение | Описание                                                                                      |
| ---------------------- | --------------------- | --------------------------------------------------------------------------------------------- |
| `constructor(...)`     | `void`                | Инициализирует компонент, получает шаблон карточки и сервис корзины.                          |
| `render(product)`      | `HTMLElement`         | Рендерит карточку товара: наполняет данные, кнопку "Купить / Удалить", добавляет обработчики. |
| `_handleBtnClick(...)` | `void`                | **(private)** Переключает товар в корзине: добавляет или удаляет, меняет текст кнопки.        |

---

**BasketComponent**

Компонент отображает содержимое корзины, управляет рендером списка товаров, общей суммой и кнопкой оформления заказа. Реактивно обновляется при изменении корзины

**Свойства**

| Свойство                       | Тип                           | Описание                                                      |
| ------------------------------ | ----------------------------- | ------------------------------------------------------------- |
| `_basketTemplate`              | `HTMLTemplateElement`         | Шаблон DOM-разметки корзины (`#basket`).                      |
| `_basketService`               | `BasketService`               | Сервис для получения и управления товарами в корзине.         |
| `_basketCardComponent`         | `BasketCardComponent`         | Компонент, отвечающий за создание карточек товаров в корзине. |
| `_statefulEventEmitterService` | `StatefulEventEmitterService` | Сервис событий для перехода к оформлению заказа.              |

**Методы**

| Метод                        | Возвращает    | Описание                                                                                                            |
| ---------------------------- | ------------- | ------------------------------------------------------------------------------------------------------------------- |
| `constructor(...)`           | `void`        | Инициализирует зависимости и находит шаблон корзины.                                                                |
| `render()`                   | `HTMLElement` | Рендерит содержимое корзины: список товаров, стоимость и кнопку. Устанавливает обработчики и подписку на изменения. |
| `_appendBasketElements(...)` | `void`        | **(private)** Добавляет карточки товаров в DOM-список.                                                              |
| `_renderActionsInfo(...)`    | `void`        | **(private)** Обновляет общую стоимость, состояние кнопки и сообщение о пустой корзине.                             |

---

**GalleryComponent**

Класс GalleryComponent предназначен для отображения списка товаров в галерее на странице. Он управляет отрисовкой карточек товаров, используя переданный компонент карточки каталога

**Свойства**
  private readonly _galleryElement: HTMLElement  
  DOM-элемент галереи, в который будут добавляться карточки товаров. Инициализируется по селектору .gallery.

**Методы**

  renderProductList(products: Product[]): void  
  Отображает список товаров, переданный в виде массива. Для каждого товара создаётся карточка через CardCatalogComponent, после чего она добавляется в DOM внутри элемента галереи

---

**CardCatalogComponent**

Класс CardCatalogComponent отвечает за создание карточек товаров для отображения в каталоге. Он инкапсулирует логику генерации карточки и обработки клика по ней

**Свойства**

  private readonly _cardCatalogTemplateElement: HTMLTemplateElement
  Ссылка на HTML-шаблон карточки каталога, получаемая из DOM по селектору #card-catalog.

**Методы**

  render(product: Product): HTMLElement  
  Создаёт DOM-элемент карточки товара на основе шаблона. Заполняет элементы карточки данными товара: категорией, заголовком, изображением и ценой. Назначает обработчик клика на карточку, вызывающий внутренний метод _cardCatalogClick.

  private _cardCatalogClick(product: Product): void  
  Обрабатывает клик по карточке каталога. Генерирует событие OPEN_CARD_FULL с данными товара, используя StatefulEventEmitterService. Это событие может быть использовано для открытия модального окна с подробной информацией о товаре

---

**BasketHeaderComponent**

Класс BasketHeaderComponent предназначен для отображения и обновления информации о корзине в шапке сайта. Также он обрабатывает клик по иконке корзины для открытия модального окна с её содержимым.

**Свойства**

  private readonly _headerBasketElement: HTMLElement  
  Ссылка на DOM-элемент корзины в шапке (.header__basket).

  private readonly _counterElement: HTMLElement  
  Ссылка на элемент счётчика количества товаров в корзине (.header__basket-counter).

**Методы**

  setQuantityProductsInBasket(quantity: number): void  
  Обновляет текстовое содержимое счётчика товаров в корзине, устанавливая переданное количество.

  private _initEventListeners(): void  
  Назначает обработчик клика по элементу корзины. При клике испускается событие OPEN_CART через StatefulEventEmitterService, что может использоваться для отображения модального окна корзины.

---

**BasketCardComponent**

Класс BasketCardComponent отвечает за создание DOM-элемента карточки товара, отображаемой в корзине. Он инкапсулирует логику визуализации одного элемента списка корзины и обработку удаления товара.

**Свойства**

  private readonly _basketCardTemplate: HTMLTemplateElement  
  Ссылка на HTML-шаблон карточки товара в корзине (#card-basket), используемый для клонирования DOM-элемента.

**Методы**

  render(product: Product, index: number): HTMLLIElement  
  Создаёт и возвращает элемент карточки товара на основе шаблона.  
  Устанавливает:  
    порядковый номер (index + 1),  
    название товара,  
    цену товара в текстовом виде.
    Также добавляет обработчик на кнопку удаления, который вызывает приватный метод _deleteProduct.

  private _deleteProduct(product: Product): void  
  Удаляет товар из корзины, вызывая метод remove у BasketService

---

**ValidationOrderService**

Сервис предназначен для валидации полей заказа. Используется для проверки обязательных данных: email, телефон, адрес. Предоставляет результат валидации и сообщения об ошибках

**Методы**

| Метод                          | Возвращает                                                           | Описание                                                                                                       |
| ------------------------------ | -------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------- |
| `validate(order, fields)`      | `{ isValid: boolean; errors: Partial<Record<keyof Order, string>> }` | Проверяет валидность указанных полей объекта `order`. Возвращает флаг валидности и объект с ошибками по полям. |
| `_validateField(field, value)` | `string \| null` **(private)**                                       | Проверяет одно поле заказа. Возвращает строку ошибки или `null`, если значение корректно.                      |


---

**DIContainer**

Класс DIContainer реализует простой механизм Dependency Injection (DI) с поддержкой singleton и transient областей жизненного цикла.

Позволяет регистрировать зависимости (провайдеры) и автоматически разрешать их с учётом указанного скоупа и вложенных зависимостей

**Свойства**

| Свойство      | Тип                       | Описание                                                                                    |
| ------------- | ------------------------- | ------------------------------------------------------------------------------------------- |
| `_registry`   | `Map<string, DIProvider>` | Реестр зарегистрированных провайдеров: хранит информацию о классах, зависимостях и скоупах. |
| `_singletons` | `Map<string, any>`        | Хранилище уже созданных singleton-экземпляров.                                              |

**Методы**

| Метод                           | Аргументы                                                                                                                                                     | Возвращает | Описание                                                                                                                                                                                         |
| ------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `register<T>(key, DIProvider?)` | - `key: DIConstructor<T>` – класс для регистрации<br>- `DIProvider?: Partial<DIProvider<T>>` – параметры регистрации (опционально: класс, зависимости, скоуп) | `void`     | Регистрирует класс и его зависимости. Проверяет соответствие числа зависимостей числу параметров конструктора. По умолчанию скоуп — `singleton`.                                                 |
| `resolve<T>(key)`               | - `key: string \| DIConstructor<T>` — имя класса или сам конструктор                                                                                          | `T`        | Создаёт и возвращает экземпляр. Повторно использует singleton-экземпляр, если указан `singleton`. Вложенные зависимости разрешаются автоматически. Бросает ошибку, если ключ не зарегистрирован. |

## Модели данных и типы:

**Типы и интерфейсы**

ProductCategory  
Тип, определяющий возможные категории продукта

```
type ProductCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```
---

Интерфейс описывает товар:  
  id — уникальный идентификатор товара.  
  description — описание товара.  
  image — ссылка на изображение.  
  title — название.  
  category — категория (тип ProductCategory).  
  price — цена товара или null, если товар недоступен для покупки.

```
interface Product {
  id: string;
  description: string;
  image: string;
  title: string;
  category: ProductCategory;
  price: number | null;
}
```

---

Payment

```
type Payment = 'online' | 'offline';
```

Тип метода оплаты:  
  'online' — онлайн-оплата,  
  'offline' — оплата при получении

---

CreateOrderRequest

```
interface CreateOrderRequest {
  payment: Payment;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Интерфейс для отправки заказа:  
  payment — способ оплаты.  
  email — адрес электронной почты покупателя.  
  phone — номер телефона.  
  address — адрес доставки.  
  total — итоговая сумма заказа.
  items — массив id товаров в заказе

---

CreateOrderResponse

```
interface CreateOrderResponse {
  id: string;
  total: number;
}
```

Ответ сервера на создание заказа:
  id — идентификатор созданного заказа.
  total — подтверждённая сумма

---

GetAllProductsResponse

```
interface GetAllProductsResponse {
  total: number;
  items: Product[];
}
```

Ответ API при получении списка продуктов:  
  total — общее количество товаров.  
  items — массив объектов типа Product

---

Order

```
interface Order {
  payment: Payment;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Полное представление заказа в приложении (аналог CreateOrderRequest), может использоваться локально.

---

Перечисление  
EventNames

```
enum EventNames {
  OPEN_CARD_FULL = 'open-card-full',
  BASKET = 'basket',
  OPEN_CART = 'open-cart',
  ORDER = 'order',
  OPEN_ORDER_ADDRESS_PAYMENT = 'open-order-address-payment',
  OPEN_ORDER_EMAIL_PHONE = 'open-order-email-phone',
  OPEN_SUCCESS_ORDER = 'open-success-order',
}
```

Перечисление ключевых событий в приложении. Используется для взаимодействия между компонентами через событийную систему

---

Объект сопоставления  
categoryCompareObj

```
const categoryCompareObj = {
  'софт-скил': 'soft',
  'дополнительное': 'additional',
  'другое': 'other',
  'кнопка': 'button',
  'хард-скил': 'hard'
};
```

Объект, сопоставляющий внутренние категории (ProductCategory). Используется для задания CSS классов для категорий.


---

## Типы для DI контейнера

Конструктор, который может быть вызван с любыми аргументами и создаёт объект типа T
```
type DIConstructor<T = any> = new (...args: any[]) => T;
```

---

Область жизненного цикла:  
- 'singleton' — один экземпляр на контейнер;
- 'transient' — каждый вызов создает новый экземпляр

```
type DIScope = 'singleton' | 'transient';
```

---

Провайдер описывает, как создать и зарегистрировать класс в контейнере
```
interface DIProvider<T = any> {
  useClass: DIConstructor<T>;
  deps?: (string | DIConstructor)[];
  scope?: DIScope;
}
```
| Свойство   | Тип                | Описание                                    |                                                 |
| ---------- | ------------------ | ------------------------------------------- | ----------------------------------------------- |
| `useClass` | `DIConstructor<T>` | Класс, создаваемый контейнером              |                                                 |
| `deps`     | string или DIConstructor)[]                                   | Массив зависимостей, передаваемых в конструктор |
| `scope`    | `DIScope`          | Жизненный цикл (по умолчанию `'singleton'`) |                                                 |


---

Интерфейс для классов, которые могут использоваться в DI. Поле inject содержит массив зависимостей, которые необходимо внедрить в конструктор

```
interface DIInjectable<T = any> {
  new (...args: any[]): T;
  inject?: DIConstructor<any>[];
}
```