# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с TS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

- src/components/base - базовые классы, от Яндекс Практикума
- src/components/features - функциональные классы, которые реализуют определённые фичи
- src/services - сервисы, в которые выносится логика


### Общий стиль проекта

Архитектура проекта построена по принципам MVVM с EventEmitter-реактивностью, где:

- View отвечает только за отображение и взаимодействие с пользователем
- Model содержит бизнес-логику, API-запросы и валидацию
- ViewModel реализован через OrderService, BasketService, который не хранит состояние, а только управляет событиями (через StatefulEventEmitterService), действуя как посредник между представлением и моделью

При этом реализована строгая декомпозиция, аналогичная MVP:
- Все DOM-элементы кэшируются и не ищутся повторно
- Представление не знает ни о данных, ни о правилах валидации
- Логика бизнес-правил и отправки запроса находится в модели
- Коммуникация между слоями — через событийную систему (StatefulEventEmitterService)

**View (Компоненты)**

- Все компоненты реализуют интерфейс Component, в котором основным методом является render(), возвращающий HTMLElement
- DOM-элементы получаются один раз при создании экземпляра компонента, из шаблонов (`<template>`)
- В обработчиках событий (input, submit) компоненты не хранят данные, а передают их в OrderService (ViewModel)
- Подписка на изменения состояния происходит через onFormStateChange(), который обновляет UI при изменении валидности формы
- Примеры: EmailPhoneOrderComponent, PaymentAddressOrderComponent, BasketComponent

**Model (Сервисы)**

- ValidationOrderService: отвечает за валидацию формы. Валидация производится в момент изменения input, а не при отправке формы
- ApiOrderService и ApiProductsService: инкапсулируют запросы к API, не связаны напрямую с интерфейсом
- BasketService: модель состояния корзины, управляет данными о продуктах
- Ни один из сервисов не взаимодействует с DOM

**ViewModel (OrderService, BasketService, StatefulEventEmitterService)**

- OrderService как и BasketService не хранит локального состояния. Вместо этого, он агрегирует данные формы, передавая их через StatefulEventEmitterService и получает их обратно
- В OrderService реализованы методы:
- - updateEmail, updatePhone, setAddress, setPaymentMethod — обновляют поля формы
- - onFormStateChange — подписка на изменения валидации, возвращает валидность формы и ошибки
- - submit — валидирует и отправляет форму. Если есть ошибки — выводит предупреждение
- StatefulEventEmitterService служит как хранилище последнего состояния и event bus

**Поток данных (пример: EmailPhone форма)**

- Пользователь вводит email или телефон → EmailPhoneOrderComponent вызывает OrderService.updateEmail() / updatePhone().
- OrderService через StatefulEventEmitterService эмитит новое значение заказа (ORDER_CHANGED).
- Через подписку onFormStateChange() данные валидируются моделью (ValidationOrderService), и обратно прокидываются в компонент (isValid, errors).
- Компонент обновляет UI: отображает ошибки и активирует кнопку отправки.
- При сабмите вызывается OrderService.submit() — отправляется запрос, после чего открывается SuccessOrderComponent

**Принципы и требования — чеклист**

| Требование                              | Подробности                                                             |
| --------------------------------------- | ----------------------------------------------------------------------- |
| Каждый класс выполняет одну задачу      | `OrderService` — ViewModel, `ValidationOrderService` — только валидация |
| Компоненты не валидируют данные         | Вся логика в `ValidationOrderService`                                   |
| Компоненты не хранят данные             | Только `OrderService` агрегирует                                        |
| Повторный поиск DOM — отсутствует       | Все элементы берутся из шаблона один раз                                |
| Подписки снимаются при закрытии         | this._modalService.onClose + отписка                                                 |
| Повторяющийся код — выделен             | `cloneTemplate`, `renderAll`, `onFormStateChange` и т.д.                |
| API не вызывается из компонента         | Вызов через `OrderService.submit()`                                     |
| Модель обновляется при input, не submit | `inputEmail.addEventListener(...)`                                      |


**Почему MVVM, а не MVP?**

В классическом MVP презентер является координатором и сам вызывает обновления View. В данной архитектуре View и Model соединены через реактивную событийную модель. Это ближе к MVVM, где ViewModel (OrderService, BasketService) принимает команды и эмитит состояние, а View подписывается и обновляется

В данном случае архитектура ближе к MVP по ответственности классов, но реализована реактивно: через ViewModel-образный сервис (OrderService), который не содержит состояния, но управляет реактивной моделью формы. Это упрощает тестирование, уменьшает связанность и соответствует SRP

**Заключение**

Структура кода строго разделена на:
- Компоненты отображения (Component)
- Сервисы состояния и логики (Service)
- Вспомогательные утилиты

Основной акцент сделан на реактивной валидации формы, минимальной связанности между слоями, отказе от прямой работы с DOM в бизнес-логике. Все изменения модели производятся при input, а не при submit. Код полностью соответствует требованиям MVP с современными улучшениями из MVVM-подхода

## **Использование DI (Dependency Injection)**

**Зачем нужен DI в проекте**

В проекте реализован контейнер зависимостей (registerDependencies()), обеспечивающий инверсию управления (IoC). Это означает, что классы не создают свои зависимости напрямую, а получают их извне — через конструктор

основные проблемы, которые решает DI:

| Проблема                             | Как решает DI                                                                       |
| ------------------------------------ | ----------------------------------------------------------------------------------- |
| Жёсткая связанность между модулями   | Компоненты не создают зависимости напрямую, а получают их от контейнера             |
| Сложность тестирования и мокирования | Любой сервис можно заменить на подделку при тестах                                  |
| Проблемы порядка инициализации       | Все зависимости явно зарегистрированы и разрешаются в нужном порядке                |
| Скрытые зависимости                  | Благодаря `deps` явно указано, что нужно каждому классу                             |
| Повторное использование              | Один и тот же сервис можно передавать разным компонентам (например, `OrderService`) |
| Централизованная точка конфигурации  | Все зависимости описаны в одном месте — `registerDependencies()`                    |

<br><br>
Как это выглядит:

```
container.register(OrderService, {
  deps: [StatefulEventEmitterService, ValidationOrderService, ApiOrderService, BasketService]
});
```

Этот код указывает, что OrderService не создает свои зависимости сам, а полагается на контейнер, который их предоставит. Благодаря этому:
- Появляется явная структура зависимостей
- Упрощается масштабирование проекта
- Классы становятся легче для повторного использования

Все зависимости между слоями реализованы через контейнер зависимостей — это позволяет строго контролировать структуру, избежать дублирования и повысить масштабируемость. Компоненты не создают сервисы сами, а получают нужные зависимости через конструктор, что соответствует принципам инверсии управления (IoC) и единственной ответственности (SRP)

**Итог: зачем DI**

В кратком виде:
- Делает архитектуру явной и масштабируемой
- Облегчает тестирование
- Соответствует принципам SOLID
- Удовлетворяет формулировке задания: «взаимодействие между классами реализуется вне самих классов»
- Разгружает классы от ответственности по созданию зависимостей

---

## Описание всех классов:
**AppController**  
Основной контроллер приложения, который отвечает за инициализацию, загрузку данных, отображение компонентов и подписку на события.

**Методы**  
| Метод                       | Аргументы | Возвращаемое значение | Описание                                                                                         |
| --------------------------- | --------- | --------------------- | ------------------------------------------------------------------------------------------------ |
| `constructor`               | См. выше  | —                     | Инициализация контроллера с передачей всех зависимостей                                          |
| `init`                      | —         | `void`                | Инициализация приложения: загрузка продуктов и установка подписок на события                     |
| `_loadProductsAndRender`    | —         | `void`                | Загружает список продуктов через сервис и передает их в компонент галереи                        |
| `_initCustomEventListeners` | —         | `void`                | Подписывается на кастомные события для открытия модальных окон и обновления информации в корзине |

---
`ApiService` — базовый сервисный класс для работы с API. Он наследуется от класса `Api`, автоматически устанавливая базовый URL для всех HTTP-запросов. Используется как промежуточный слой, чтобы избежать повторяющегося указания базового URL в каждом конкретном API-сервисе. Не имеет своих методов, только наследует методы от `Api`

---

`ApiProductsService` - cервисный класс для взаимодействия с продуктами через API. Наследуется от ApiService

getAll(): `Promise<Product[]>`
  Выполняет GET-запрос к '/product'.
  Возвращает массив объектов Product, полученных из поля items ответа

getById(id: string): `Promise<Product>`
  Выполняет GET-запрос к '/product/{id}'.
  Возвращает объект Product по его идентификатору.

---

`ApiOrderService` - cервисный класс для отправки заказов на сервер. Наследуется от ApiService

send(createOrderRequest: CreateOrderRequest): `Promise<CreateOrderResponse>`
  Выполняет POST-запрос к '/order', отправляя данные заказа.
  Принимает объект createOrderRequest, содержащий информацию о заказе.
  Возвращает промис с объектом ответа CreateOrderResponse

---

**StatefulEventEmitterService** 
расширение EventEmitter, которое запоминает последнее значение каждого события. Позволяет:
- немедленно получить последнее значение события при подписке;
- реактивно подписываться на изменения состояния;
- централизованно управлять и очищать кэшированные значения.

**Свойства**

| Свойство      | Тип                | Описание                                                                                                                             |
| ------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------ |
| `_lastValues` | `Map<string, any>` | Хранит последние значения по каждому имени события. Используется для моментального ответа при подписке или ожидании через `waitFor`. |

**Методы**

| Метод                               | Аргументы                                                              | Возвращает       | Описание                                                                                                                                       |
| ----------------------------------- | ---------------------------------------------------------------------- | ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| `emit<T>(eventName, data?)`         | `eventName: string`<br>`data?: T`                                      | `void`           | Переопределяет базовый `emit`, сохраняя последнее значение события перед его распространением.                                                 |
| `on<T>(eventName, callback)`        | `eventName: EventName`<br>`callback: (data: T) => void`                | `void`           | Подписывает на событие и немедленно вызывает обработчик с последним сохранённым значением (если есть).                                         |
| `offAllByEventName(eventName)`      | `eventName: EventName`                                                 | `void`           | Удаляет всех слушателей события и очищает его кэшированное значение.                                                                           |
| `getLast<T>(eventName)`             | `eventName: string`                                                    | `T \| undefined` | Возвращает последнее значение события, если оно было сохранено.                                                                                |
| `clearLast(eventName?)`             | `eventName?: string`                                                   | `void`           | Очищает последнее значение одного события или всех событий, если аргумент не передан.                                                          |

---

`OrderService` - cервис, инкапсулирующий бизнес-логику создания и отправки заказа. Работает через брокер событий `StatefulEventEmitterService` и API-клиент `ApiOrderService`

**Зависимости**
- StatefulEventEmitterService — управление состоянием и событиями заказа.
- ValidationOrderService — валидация данных заказа.
- ApiOrderService — отправка заказа на сервер.
- BasketService — получение информации о товарах в корзине

**Методы**  
**Приватные**

  _emitOrderUpdate(partialOrder: `Partial<Order>`): void  
  Обновляет и эмитит новое состояние заказа.

  _getCurrentOrder(): `Partial<Order> `  
  Получает текущее состояние заказа.

**Публичные**

  updateEmail(email: string): void  
  Обновляет email в заказе.

  updatePhone(phone: string): void  
  Обновляет телефон в заказе.

  setAddress(address: string): void  
  Устанавливает адрес доставки.

  setPaymentMethod(payment: Payment): void  
  Устанавливает метод оплаты.

  clear(): void  
  Очищает текущее состояние заказа.

  onFormStateChange(fields: `(keyof Order)[]`, callback: (state: `{ isValid: boolean; errors: Partial<Record<keyof Order, string>> }) => void`): `() => void`  
  Подписывается на изменения состояния формы по указанным полям и вызывает callback с результатами валидации. Возвращает функцию для отписки.

  submit(): void  
  Валидирует и отправляет заказ. При ошибках валидации или отправки выводит предупреждения.

---
`BasketService` - cервис, управляющий корзиной товаров. Использует брокер событий StatefulEventEmitterService для хранения и трансляции состояния корзины

getAll(): Product[]  
    Возвращает список всех товаров в корзине.
    Если данные отсутствуют — возвращает пустой массив.

getById(id: string): Product | undefined  
    Ищет товар по ID в текущем состоянии корзины.
    Возвращает найденный товар или undefined, если такого нет.

getPriceBasket(): number  
    Считает и возвращает общую стоимость всех товаров в корзине.

add(product: Product): void  
    Добавляет товар в корзину, если он ещё не добавлен.
    Эмитирует события:
        add-card-to-basket-{id} — добавление конкретного товара.
        remove-card-to-basket-{id} — удаление соответствующих подписчиков.
        BASKET — обновлённое состояние корзины.

remove(product: Product): void  
    Удаляет товар из корзины по ID.
    Эмитирует события:
        remove-card-to-basket-{id} — факт удаления товара.
        BASKET — обновлённое состояние корзины.

onBasket(callback: (products: Product[]) => void): void  
    Подписывает переданный callback на изменения в корзине (EventNames.BASKET).

offBasket(callback: (products: Product[]) => void): void  
    Удаляет переданный callback из подписки на изменения корзины.

onBasketById(id: string, callback: (product: Product) => void): void  
    Подписывает обработчик на событие добавления конкретного товара по ID.

offBasketById(id: string): void  
    Удаляет все подписки, связанные с добавлением конкретного товара по ID.

clear(): void  
    Полностью очищает корзину, эмитируя пустой список товаров в EventNames.BASKET

---
**ComponentRegistryService**  
Сервис для регистрации компонентов и связи между экземплярами компонентов и DOM-элементами. Позволяет отслеживать регистрацию компонентов и получать их по DOM-узлам или инстансам.

**Свойства (приватные)**  
| Свойство      | Тип                                             | Описание                                                                     |
| ------------- | ----------------------------------------------- | ---------------------------------------------------------------------------- |
| `_byInstance` | `WeakMap<BaseComponent, ComponentRegistryInfo>` | Хранит связь между экземплярами компонентов и их регистрационной информацией |
| `_byElement`  | `WeakMap<HTMLElement, ComponentRegistryInfo>`   | Хранит связь между DOM-элементами и регистрационной информацией компонента   |
| `_listeners`  | `Map<string, Set<() => void>>`                  | Колбэки, ожидающие регистрацию компонента с определённым ID                  |

**Методы**  
| Метод                     | Аргументы                                         | Возвращает                           | Описание                                                                                                               |
| ------------------------- | ------------------------------------------------- | ------------------------------------ | ---------------------------------------------------------------------------------------------------------------------- |
| `register`                | `instance: BaseComponent`, `element: HTMLElement` | `void`                               | Регистрирует компонент и связывает его с DOM-элементом. Устанавливает `data-component-id`. Вызывает ожидающие колбэки. |
| `getByInstance`           | `instance: BaseComponent`                         | `ComponentRegistryInfo \| undefined` | Возвращает регистрационную информацию по инстансу компонента.                                                          |
| `getByElement`            | `element: HTMLElement`                            | `ComponentRegistryInfo \| undefined` | Возвращает регистрационную информацию по DOM-элементу.                                                                 |
| `onRegisteredByInstance`  | `instance: BaseComponent`, `callback: () => void` | `void`                               | Выполняет `callback`, если компонент уже зарегистрирован, иначе добавляет его в очередь ожидания регистрации.          |
| `_generateId` *(private)* | `instance: BaseComponent`                         | `string`                             | Генерирует уникальный ID для компонента на основе имени класса и `hashCode`.                                           |


**Типы, использующиеся в классе**  
```
type ComponentRegistryInfo = {
  instance: BaseComponent;
  element: HTMLElement;
  id: string;
};
```
BaseComponent и hashCode предполагаются определёнными извне — BaseComponent это базовый класс компонента, hashCode(instance) — функция генерации хэш-кода объекта.

---

**ModalService**  
Сервис управления модальными окнами: открытие, закрытие, отслеживание событий закрытия, поддержка как компонентов, так и обычных DOM-элементов.

**Свойства (приватные)**  

| Свойство                     | Тип                                                                                 | Описание                                                        |
| ---------------------------- | ----------------------------------------------------------------------------------- | --------------------------------------------------------------- |
| `_currentModal`              | `{ element: HTMLElement; component?: BaseComponent; onClose?: () => void } \| null` | Текущая активная модалка, если она открыта                      |
| `_onCloseListeners`          | `Map<HTMLElement, Set<() => void>>`                                                 | Постоянные колбэки, вызываемые при закрытии модалки             |
| `_pendingCloseListeners`     | `WeakMap<BaseComponent \| HTMLElement, Set<() => void>>`                            | Колбэки `onClose`, ожидающие открытия соответствующего контента |
| `_pendingCloseOnceListeners` | `WeakMap<BaseComponent \| HTMLElement, Set<() => void>>`                            | Одноразовые колбэки `onCloseOnce`, ожидающие открытия           |
| `_modalComponent`            | `ModalComponent`                                                                    | Компонент, отвечающий за визуализацию и анимацию модалки        |
| `_componentRegistryService`  | `ComponentRegistryService`                                                          | Сервис для получения DOM-элемента по компоненту и наоборот      |


**Методы**

| Метод                             | Аргументы                                                                                                              | Возвращает            | Описание                                                                                  |
| --------------------------------- | ---------------------------------------------------------------------------------------------------------------------- | --------------------- | ----------------------------------------------------------------------------------------- |
| `constructor`                     | `_modalComponent: ModalComponent`, `_componentRegistryService: ComponentRegistryService`                               | `ModalService`        | Создаёт экземпляр сервиса                                                                 |
| `open`                            | `content: BaseComponent \| HTMLElement`, `renderArgs?: any`, `options?: { onOpen?: () => void; onClose?: () => void }` | `void`                | Открывает модалку с указанным контентом. Закрывает предыдущую, если она открыта           |
| `close`                           | `content: BaseComponent \| HTMLElement`                                                                                | `void`                | Закрывает модалку, если она соответствует переданному контенту                            |
| `onClose`                         | `target: BaseComponent \| HTMLElement`, `callback: () => void`                                                         | `void`                | Добавляет постоянный обработчик, вызываемый при закрытии модалки                          |
| `onCloseOnce`                     | `target: BaseComponent \| HTMLElement`, `callback: () => void`                                                         | `void`                | Добавляет одноразовый обработчик, вызываемый при закрытии модалки                         |
| `_invokeRegularCloseCallbacks`    | `element: HTMLElement`                                                                                                 | `void`                | Внутренне вызывает все зарегистрированные onClose-колбэки                                 |
| `_handleModalClose`               | `modal: { element: HTMLElement; component?: BaseComponent; onClose?: () => void }`                                     | `void`                | Внутренне вызывает пользовательский `onClose`, если он задан                              |
| `_resolveElement`                 | `content: BaseComponent \| HTMLElement`, `renderArgs?: any`                                                            | `HTMLElement`         | Получает DOM-элемент из компонента (через `render`) или возвращает `HTMLElement` как есть |
| `_isComponent`                    | `obj: any`                                                                                                             | `boolean`             | Проверяет, является ли объект компонентом (имеет метод `render`)                          |
| `_getElementIfOpen`               | `content: BaseComponent \| HTMLElement`                                                                                | `HTMLElement \| null` | Возвращает DOM-элемент, если переданный контент — это текущая открытая модалка            |
| `_addPendingListener`             | `storage: WeakMap`, `target: BaseComponent \| HTMLElement`, `callback: () => void`                                     | `void`                | Вспомогательный метод для регистрации отложенного колбэка                                 |
| `_collectPendingRegularListeners` | `target: BaseComponent \| HTMLElement`                                                                                 | `() => void`\[]       | Забирает и удаляет отложенные `onClose`-колбэки                                           |
| `_collectPendingOnceListeners`    | `target: BaseComponent \| HTMLElement`                                                                                 | `() => void`\[]       | Забирает и удаляет отложенные `onCloseOnce`-колбэки                                       | |

Используемые типы
```
type ModalOptions = {
  onOpen?: () => void;
  onClose?: () => void;
};

type CurrentModal = {
  element: HTMLElement;
  component?: BaseComponent;
  onClose?: () => void;
};
```
---

**ProductsService**

Сервер-адаптер для работы с моделью продуктов на базе StatefulEventEmitterService

Основные обязанности:
- Загружает данные о продуктах через API.
- Передаёт данные в модель (StatefulEventEmitterService), которая хранит состояние и рассылает обновления.
- Обеспечивает подписку представления на реактивные изменения данных.
- Позволяет отписаться от обновлений, например, при размонтировании компонента.

**Свойства**

| Свойство                       | Тип                           | Описание                                                  |
| ------------------------------ | ----------------------------- | --------------------------------------------------------- |
| `_apiProductsService`          | `ApiProductsService`          | Сервис для загрузки данных продуктов с API                |
| `_statefulEventEmitterService` | `StatefulEventEmitterService` | Модель — сервис событий с хранением состояния и подпиской |

**Методы**

| Метод                 | Параметры                                                                                              | Возвращаемое значение | Описание                                                                                                 |
| --------------------- | ------------------------------------------------------------------------------------------------------ | --------------------- | -------------------------------------------------------------------------------------------------------- |
| `constructor`         | `_apiProductsService: ApiProductsService`, `_statefulEventEmitterService: StatefulEventEmitterService` | -                     | Инициализирует адаптер с сервисом API и моделью                                                          |
| `getAll`              | `callback: (products: Product[]) => void`, `onDestroy?: (unsubscribe: () => void) => void`             | `void`                | Загружает продукты, обновляет модель, подписывает callback на события обновления, с возможностью отписки |
| `_update` (приватный) | `products: Product[]`                                                                                  | `void`                | Эмитит событие обновления продуктов в модель                                                             |

---
**BaseComponent**  
Абстрактный базовый класс для всех компонентов. Предоставляет общую логику рендеринга через шаблон (template) и автоматическую регистрацию DOM-элемента в ComponentRegistryService.

**Свойства**  
| Свойство                    | Модификатор | Тип                        | Описание                                                    |
| --------------------------- | ----------- | -------------------------- | ----------------------------------------------------------- |
| `_template`                 | `protected` | `HTMLTemplateElement`      | Шаблон, на основе которого создаётся DOM-элемент компонента |
| `_componentRegistryService` | `private`   | `ComponentRegistryService` | Сервис для регистрации компонента в реестре                 |

**Методы**  
| Метод              | Модификатор | Аргументы                       | Возвращает                    | Описание                                                                                     |
| ------------------ | ----------- | ------------------------------- | ----------------------------- | -------------------------------------------------------------------------------------------- |
| `constructor`      | `public`    | `template: HTMLTemplateElement` | —                             | Инициализирует компонент с HTML-шаблоном и внедряет `ComponentRegistryService`               |
| `render`           | `abstract`  | `...args: any[]`                | `RegisteredElement<TElement>` | Абстрактный метод, реализуется в потомках. Возвращает отрендеренный и зарегистрированный DOM |
| `_cloneTemplate`   | `protected` | —                               | `RegisteredElement<TElement>` | Клонирует шаблон и регистрирует DOM-элемент                                                  |
| `_registerElement` | `protected` | `element: TElement`             | `RegisteredElement<TElement>` | Регистрирует DOM-элемент через `ComponentRegistryService` и возвращает его                   |

**Используемые типы и зависимости**  
`ComponentRegistryService` — сервис, регистрирующий соответствие между компонентами и DOM-элементами.

`cloneTemplate<T>()` — функция клонирования HTML-шаблона (предположительно импортируется извне).

`RegisteredElement<T>` — тип, который представляет DOM-элемент, зарегистрированный в реестре.

---
**CachedComponent**  
CachedComponent — абстрактный компонент, основанный на BaseComponent, который рендерит контент только один раз, а затем возвращает кэшированный DOM-элемент при повторных вызовах. Подходит для компонентов без повторного монтирования.

| Параметр   | Описание                                                               |
| ---------- | ---------------------------------------------------------------------- |
| `TCache`   | Тип объекта, используемого для хранения кэшированных данных компонента |
| `TElement` | Тип HTML-элемента, возвращаемого при рендере                           |

**Свойства**  
| Свойство         | Модификатор | Тип                           | Описание                                                                 |
| ---------------- | ----------- | ----------------------------- | ------------------------------------------------------------------------ |
| `_cachedData`    | `protected` | `TCache`                      | Кэшированные данные, инициализируемые один раз через `_initCachedData()` |
| `_cachedElement` | `protected` | `RegisteredElement<TElement>` | DOM-элемент, сгенерированный из шаблона и кэшированный                   |
| `_isRegistered`  | `private`   | `boolean`                     | Флаг: зарегистрирован ли DOM-элемент в `ComponentRegistryService`        |

**Методы**  
| Метод             | Модификатор          | Аргументы                       | Возвращает                    | Описание                                                                            |
| ----------------- | -------------------- | ------------------------------- | ----------------------------- | ----------------------------------------------------------------------------------- |
| `constructor`     | `public`             | `template: HTMLTemplateElement` | —                             | Инициализирует шаблон, кэширует элемент и данные, подключает DI-инит                |
| `render`          | `public`             | `...args: any[]`                | `RegisteredElement<TElement>` | Возвращает кэшированный элемент. Первый раз регистрирует его и вызывает `_update()` |
| `_initCachedData` | `protected abstract` | —                               | `TCache`                      | Абстрактный метод: должен вернуть структуру с кэшированными данными                 |
| `_update`         | `protected`          | `...args: any[]`                | `void`                        | Обновляет состояние или содержимое компонента. Переопределяется при необходимости   |
| `_afterInit`      | `protected`          | —                               | `void`                        | Метод, вызываемый один раз после внедрения зависимостей. Опционален                 |

---
**StatelessComponent**  
Абстрактный класс-компонент, расширяющий BaseComponent, не хранящий состояния. Предназначен для простых компонентов без внутреннего кэширования или логики обновления.

**Назначение**  
Используется для компонентов, которые не содержат состояния (state) и не нуждаются в кэшировании (render вызывается каждый раз заново).  
Подходит для простых UI-компонентов — кнопок, иконок, надписей и т.п.

**Унаследованные свойства от BaseComponent**  
| Свойство                    | Модификатор | Тип                        | Описание                                              |
| --------------------------- | ----------- | -------------------------- | ----------------------------------------------------- |
| `_template`                 | `protected` | `HTMLTemplateElement`      | HTML-шаблон, на основе которого создаётся DOM-элемент |
| `_componentRegistryService` | `private`   | `ComponentRegistryService` | Сервис регистрации компонента                         |

**Унаследованные методы от BaseComponent**  
| Метод                       | Модификатор | Возвращает                    | Описание                                                                            |
| --------------------------- | ----------- | ----------------------------- | ----------------------------------------------------------------------------------- |
| `render(...args)`           | `abstract`  | `RegisteredElement<TElement>` | Должен быть реализован в потомке. Возвращает отрендеренный и зарегистрированный DOM |
| `_cloneTemplate()`          | `protected` | `RegisteredElement<TElement>` | Клонирует шаблон и регистрирует его                                                 |
| `_registerElement(element)` | `protected` | `RegisteredElement<TElement>` | Регистрирует DOM-элемент в `ComponentRegistryService`                               |

---

**ModalComponent**

Компонент, управляющий отображением и поведением модального окна. Поддерживает программное и ручное закрытие, а также колбэки открытия и закрытия.

**Свойства (приватные)**

| Свойство                  | Тип           | Описание                                                          |
| ------------------------- | ------------- | ----------------------------------------------------------------- |
| `_modalContainerElement`  | `HTMLElement` | Контейнер модального окна (`#modal-container`)                    |
| `_modalContentElement`    | `HTMLElement` | Область, куда вставляется контент модалки                         |
| `_modalCloseElement`      | `HTMLElement` | Кнопка закрытия модалки (обычно крестик)                          |
| `_openCallback`           | `() => void`  | Колбэк, вызываемый при открытии                                   |
| `_closeCallback`          | `() => void`  | Колбэк, вызываемый при любом закрытии                             |
| `_closeOnceCallback`      | `() => void`  | Колбэк, вызываемый **только при ручном** закрытии                 |
| `_isOpen`                 | `boolean`     | Флаг: модалка открыта или нет                                     |
| `_pointerDownInsideModal` | `boolean`     | Был ли `pointerdown` внутри контента модалки                      |
| `_pointerUpInsideModal`   | `boolean`     | Был ли `pointerup` внутри контента модалки                        |
| `_isProgrammaticClose`    | `boolean`     | Флаг: идёт ли сейчас программное закрытие (а не пользовательское) ||

**Методы**

| Метод                    | Аргументы                                                               | Возвращает       | Описание                                                                                   |
| ------------------------ | ----------------------------------------------------------------------- | ---------------- | ------------------------------------------------------------------------------------------ |
| `constructor`            | –                                                                       | `ModalComponent` | Инициализирует DOM-ссылки на контейнер, контент и кнопку закрытия                          |
| `open`                   | `content: HTMLElement`, `options?: { onOpen?, onClose?, onCloseOnce? }` | `void`           | Открывает модалку с контентом. Добавляет колбэки, навешивает слушатели, добавляет классы   |
| `close`                  | –                                                                       | `void`           | Программно закрывает модалку, вызывает `onClose`, **не вызывает** `onCloseOnce`            |
| `_manualClose`           | –                                                                       | `void`           | Закрывает модалку вручную (по нажатию на крестик, оверлей или Esc). Вызывает `onCloseOnce` |
| `_initEventListeners`    | –                                                                       | `void`           | Вешает обработчики событий на DOM для закрытия по UI                                       |
| `_destroyEventListeners` | –                                                                       | `void`           | Удаляет все навешанные обработчики событий                                                 |
| `_onPointerDown`         | `event: PointerEvent`                                                   | `void`           | Обрабатывает событие pointerdown и запоминает, был ли клик внутри модалки                  |
| `_onPointerUp`           | `event: PointerEvent`                                                   | `void`           | Аналогично — для pointerup                                                                 |
| `_closeByOverlay`        | `event: MouseEvent`                                                     | `void`           | Закрывает модалку при клике на оверлей (вне модалки), если клик был полностью вне контента |
| `_closeByEsc`            | `event: KeyboardEvent`                                                  | `void`           | Закрывает модалку по нажатию клавиши `Escape`                                              |

---
**SuccessOrderComponent**

Компонент, отображающий сообщение об успешном оформлении заказа. Используется внутри модального окна и взаимодействует с сервисами заказа, корзины и модалок.

**Свойства**

| Свойство                        | Тип                              | Описание                                                            |
| ------------------------------- | -------------------------------- | ------------------------------------------------------------------- |
| `_modalService`                 | `ModalService`                   | Сервис управления модальными окнами                                 |
| `_cachedData` (унаследовано)    | `SuccessOrderData`               | Кэшированные элементы: корневой элемент, описание и кнопка закрытия |
| `_cachedElement` (унаследовано) | `RegisteredElement<HTMLElement>` | Основной DOM-элемент компонента                                     |


**Методы**

| Метод             | Аргументы                     | Возвращает         | Описание                                                                  |
| ----------------- | ----------------------------- | ------------------ | ------------------------------------------------------------------------- |
| `constructor`     | `_modalService: ModalService` | —                  | Инициализирует компонент, передаёт шаблон в `CachedComponent`             |
| `_initCachedData` | —                             | `SuccessOrderData` | Инициализирует и возвращает кэшированные DOM-элементы компонента          |
| `_afterInit`      | —                             | `void`             | Навешивает обработчик клика на кнопку закрытия, который закрывает модалку |
| `_update`         | `res: CreateOrderResponse`    | `void`             | Обновляет описание успешного заказа, отображая списанную сумму            |

---

**PaymentAddressOrderComponent**

Компонент формы выбора адреса доставки и способа оплаты (наличные или карта). Работает в реактивной архитектуре через StatefulEventEmitterService и OrderService

**Свойства**

| Свойство                        | Тип                                  | Описание                                                                                           |
| ------------------------------- | ------------------------------------ | -------------------------------------------------------------------------------------------------- |
| `_orderService`                 | `OrderService`                       | Сервис управления состоянием заказа, способами оплаты, адресом и валидацией                        |
| `_statefulEventEmitterService`  | `StatefulEventEmitterService`        | Сервис для эмитации событий (переход к следующему этапу оформления заказа)                         |
| `_modalService`                 | `ModalService`                       | Сервис управления модальными окнами                                                                |
| `_cachedData` (унаследовано)    | `PaymentAddressOrderData`            | Кэшированные элементы формы: кнопки оплаты, поле адреса, кнопка отправки, блок ошибок и сама форма |
| `_cachedElement` (унаследовано) | `RegisteredElement<HTMLFormElement>` | Основной DOM-элемент формы, кэшируется при первом рендере                                          |

**Методы**

| Метод                        | Аргументы                                                                                                                 | Возвращает                | Описание                                                                                                                                              |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------- | ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| `constructor`                | `_orderService: OrderService`, `_statefulEventEmitterService: StatefulEventEmitterService`, `_modalService: ModalService` | —                         | Инициализирует компонент, передаёт форму в `CachedComponent`                                                                                          |
| `_initCachedData`            | —                                                                                                                         | `PaymentAddressOrderData` | Инициализирует и возвращает кэшированные элементы формы                                                                                               |
| `_afterInit`                 | —                                                                                                                         | `void`                    | Навешивает обработчики для кнопок выбора оплаты, поля адреса, кнопки отправки, подписывается на состояние формы, сброс состояния при закрытии модалки |
| `_setPaymentMethod`          | `currentMethod: Payment, btnOnline: HTMLButtonElement, btnOffline: HTMLButtonElement`                                     | `void`                    | Устанавливает способ оплаты в сервисе заказа и обновляет стили кнопок                                                                                 |
| `_updatePaymentButtonStyles` | `method: Payment, btnOnline: HTMLButtonElement, btnOffline: HTMLButtonElement`                                            | `void`                    | Обновляет визуальное выделение активной кнопки оплаты                                                                                                 |
| `_update`                    | —                                                                                                                         | `void`                    | Сбрасывает состояние формы: очищает адрес, сбрасывает кнопку и ошибки, устанавливает оплату по умолчанию                                              |

---

**EmailPhoneOrderComponent**

Компонент формы ввода email и телефона при оформлении заказа. Обеспечивает реактивную валидацию и отправку данных через OrderService

**Свойства**

| Свойство                        | Тип                              | Описание                                                    |
| ------------------------------- | -------------------------------- | ----------------------------------------------------------- |
| `_orderService`                 | `OrderService`                   | Сервис управления состоянием заказа, валидацией и отправкой |
| `_modalService`                 | `ModalService`                   | Сервис управления модальными окнами                         |
| `_basketService`                | `BasketService`                  | Сервис управления корзиной                                  |
| `_cachedData` (унаследовано)    | `EmailPhoneOrderData`            | Кэшированные элементы формы: input, кнопка, блок ошибок     |
| `_cachedElement` (унаследовано) | `RegisteredElement<HTMLElement>` | Основной DOM-элемент формы, кэшируется при первом рендере   |
    |


**Методы**

| Метод             | Аргументы                                                                                     | Возвращает            | Описание                                                                                                                   |
| ----------------- | --------------------------------------------------------------------------------------------- | --------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| `constructor`     | `_orderService: OrderService`, `_modalService: ModalService`, `_basketService: BasketService` | —                     | Инициализирует компонент, передаёт шаблон в `CachedComponent`                                                              |
| `_initCachedData` | —                                                                                             | `EmailPhoneOrderData` | Создаёт и возвращает кэшированные элементы: поля ввода, кнопка, блок ошибок, динамические элементы ошибок                  |
| `_afterInit`      | —                                                                                             | `void`                | Навешивает обработчики ввода, подписывается на изменения состояния формы, обработчик сабмита и сброса при закрытии модалки |
| `_clearElements`  | —                                                                                             | `void`                | Очищает значения полей, состояние кнопки и содержимое сообщений об ошибках                                                 |
| `_update`         | —                                                                                             | `void`                | Переопределяет метод обновления компонента — вызывает очистку полей и ошибок                                               |

---

**CardFullComponent**

Компонент отображает подробную карточку товара, включая изображение, категорию, цену и кнопку добавления/удаления из корзины

**Свойства**

| Свойство                        | Тип                              | Описание                                                                                  |
| ------------------------------- | -------------------------------- | ----------------------------------------------------------------------------------------- |
| `_basketService`                | `BasketService`                  | Сервис для управления корзиной товаров                                                    |
| `_cachedData` (унаследовано)    | `CardFullData`                   | Кэшированные элементы DOM: категория, заголовок, изображение, цена, кнопка, текущий товар |
| `_cachedElement` (унаследовано) | `RegisteredElement<HTMLElement>` | Основной DOM-элемент компонента                                                           |



**Методы**

| Метод             | Аргументы                                  | Возвращает     | Описание                                                                                                              |
| ----------------- | ------------------------------------------ | -------------- | --------------------------------------------------------------------------------------------------------------------- |
| `constructor`     | `_basketService: BasketService`            | —              | Инициализирует компонент с указанием шаблона                                                                          |
| `_initCachedData` | —                                          | `CardFullData` | Инициализирует кэшированные DOM-элементы                                                                              |
| `_afterInit`      | —                                          | `void`         | Устанавливает класс для категории, навешивает обработчик клика на кнопку                                              |
| `_update`         | `product: Product`                         | `void`         | Обновляет содержимое карточки (текст, изображение, цена, кнопка) в зависимости от состояния корзины и данных продукта |
| `_renderBtnText`  | `product: Product, btn: HTMLButtonElement` | `void`         | Обрабатывает нажатие кнопки: добавляет или удаляет товар из корзины, обновляет текст кнопки                           |

---

**BasketComponent**

Компонент отображает содержимое корзины, управляет рендером списка товаров, общей суммой и кнопкой оформления заказа. Реактивно обновляется при изменении корзины

**Свойства**

| Свойство                        | Тип                              | Описание                                                             |
| ------------------------------- | -------------------------------- | -------------------------------------------------------------------- |
| `_basketService`                | `BasketService`                  | Сервис для работы с данными корзины (получение товаров, цены и т.п.) |
| `_basketCardComponent`          | `BasketCardComponent`            | Компонент для рендеринга отдельной карточки товара в корзине         |
| `_statefulEventEmitterService`  | `StatefulEventEmitterService`    | Сервис для эмитации событий (открытие формы оформления заказа)       |
| `_cachedData` (унаследовано)    | `BasketComponentData`            | Кэшированные DOM-элементы                      |
| `_cachedElement` (унаследовано) | `RegisteredElement<HTMLElement>` | Основной DOM-элемент корзины, кэшируется при первом рендере          |

<br>

**Методы**

| Метод                   | Аргументы                                                                                                                                 | Возвращает            | Описание                                                                                                     |
| ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------------- | --------------------- | ------------------------------------------------------------------------------------------------------------ |
| `constructor`           | `_basketService: BasketService`, `_basketCardComponent: BasketCardComponent`, `_statefulEventEmitterService: StatefulEventEmitterService` | —                     | Инициализирует компонент, передаёт шаблон в `CachedComponent`                                                |
| `_initCachedData`       | —                                                                                                                                         | `BasketComponentData` | Инициализирует и возвращает кэшированные элементы корзины: контейнер списка товаров, кнопку оформления, итд. |
| `_afterInit`            | —                                                                                                                                         | `void`                | Настраивает рендеринг корзины, подписывается на события обновления корзины, навешивает слушатель на кнопку   |
| `_appendBasketElements` | `basketList: HTMLUListElement, products: Product[]`                                                                                       | `void`                | Добавляет в DOM карточки товаров, используя `_basketCardComponent.render`                                    |
| `_renderActionsInfo`    | `submitBtnElement: HTMLButtonElement, priceElement: HTMLSpanElement, listItemEmptyElement: HTMLElement, priceBasket: number`              | `void`                | Обновляет отображение кнопки, стоимости и сообщения "Корзина пуста"                                          |

---

**GalleryComponent**

Класс GalleryComponent предназначен для отображения списка товаров в галерее на странице. Он управляет отрисовкой карточек товаров, используя переданный компонент карточки каталога

**Свойства**  
| Свойство                | Тип                    | Описание                                    |
| ----------------------- | ---------------------- | ------------------------------------------- |
| `_galleryElement`       | `HTMLElement`          | DOM-элемент галереи (`.gallery`)            |
| `_cardCatalogComponent` | `CardCatalogComponent` | Компонент для рендеринга карточек продуктов |


**Методы**  
| Метод               | Аргументы                                     | Возвращает | Описание                                                             |
| ------------------- | --------------------------------------------- | ---------- | -------------------------------------------------------------------- |
| `constructor`       | `_cardCatalogComponent: CardCatalogComponent` | —          | Инициализирует компонент и находит элемент галереи в DOM             |
| `renderProductList` | `products: Product[]`                         | `void`     | Очищает галерею и добавляет карточки для каждого продукта из массива |

---

**CardCatalogComponent**

Класс CardCatalogComponent отвечает за создание карточек товаров для отображения в каталоге. Он инкапсулирует логику генерации карточки и обработки клика по ней.

**Свойства**  

| Свойство                       | Тип                           | Описание                              |
| ------------------------------ | ----------------------------- | ------------------------------------- |
| `_statefulEventEmitterService` | `StatefulEventEmitterService` | Сервис для эмита событий в приложении |
| `_template` (унаследовано)     | `HTMLTemplateElement`         | Шаблон DOM-элемента карточки из DOM   |


**Методы**  

| Метод               | Аргументы                                                   | Возвращает          | Описание                                                                                |
| ------------------- | ----------------------------------------------------------- | ------------------- | --------------------------------------------------------------------------------------- |
| `constructor`       | `_statefulEventEmitterService: StatefulEventEmitterService` | —                   | Инициализация компонента с указанием шаблона                                            |
| `render`            | `product: Product`                                          | `RegisteredElement` | Создаёт и возвращает DOM-элемент карточки, заполненный данными товара                   |
| `_cardCatalogClick` | `product: Product`                                          | `void`              | Обработчик клика по карточке — инициирует событие открытия полной информации о продукте |

---
**BasketHeaderComponent**  

Класс BasketHeaderComponent предназначен для отображения и обновления информации о корзине в шапке сайта. Также он обрабатывает клик по иконке корзины для открытия модального окна с её содержимым.

**Свойства**

| Свойство                       | Тип                                                          | Описание                                                            |
| ------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------------- |
| `_headerBasketElement`         | `HTMLElement`                                                | DOM-элемент корзины в шапке (`.header__basket`)                     |
| `_counterElement`              | `HTMLElement`                                                | DOM-элемент счётчика количества товаров (`.header__basket-counter`) |
| `_statefulEventEmitterService` | `StatefulEventEmitterService` (внедряется через конструктор) | Сервис для эмитации событий                                         |


**Методы**

| Метод                         | Аргументы                                                   | Возвращает | Описание                                                                                        |
| ----------------------------- | ----------------------------------------------------------- | ---------- | ----------------------------------------------------------------------------------------------- |
| `constructor`                 | `_statefulEventEmitterService: StatefulEventEmitterService` | —          | Инициализирует элементы DOM и навешивает слушатели событий                                      |
| `setQuantityProductsInBasket` | `quantity: number`                                          | `void`     | Обновляет текстовое содержимое счётчика количества товаров в корзине                            |
| `_initEventListeners`         | —                                                           | `void`     | Навешивает обработчик клика на корзину, который вызывает событие `OPEN_CART` через EventEmitter |

---

**BasketCardComponent**

Класс BasketCardComponent отвечает за создание DOM-элемента карточки товара, отображаемой в корзине. Он инкапсулирует логику визуализации одного элемента списка корзины и обработку удаления товара.

**Свойства**
| Свойство                   | Тип                   | Описание                                                           |
| -------------------------- | --------------------- | ------------------------------------------------------------------ |
| `_basketService`           | `BasketService`       | Сервис управления корзиной товаров                                 |
| `_template` (унаследовано) | `HTMLTemplateElement` | Шаблон DOM-элемента для карточки корзины (инициализируется из DOM) |


**Методы**
| Метод            | Аргументы                         | Возвращает                         | Описание                                                                           |
| ---------------- | --------------------------------- | ---------------------------------- | ---------------------------------------------------------------------------------- |
| `constructor`    | `_basketService: BasketService`   | —                                  | Инициализирует компонент, передавая шаблон из DOM родительскому классу             |
| `render`         | `product: Product, index: number` | `RegisteredElement<HTMLLIElement>` | Создаёт и возвращает DOM-элемент карточки товара с заполненными данными            |
| `_deleteProduct` | `product: Product`                | `void`                             | Обработчик удаления товара: вызывает сервис корзины для удаления указанного товара |

---

**ValidationOrderService**

Сервис предназначен для валидации полей заказа. Используется для проверки обязательных данных: email, телефон, адрес. Предоставляет результат валидации и сообщения об ошибках

**Методы**

| Метод                          | Возвращает                                                           | Описание                                                                                                       |
| ------------------------------ | -------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------- |
| `validate(order, fields)`      | `{ isValid: boolean; errors: Partial<Record<keyof Order, string>> }` | Проверяет валидность указанных полей объекта `order`. Возвращает флаг валидности и объект с ошибками по полям. |
| `_validateField(field, value)` | `string \| null` **(private)**                                       | Проверяет одно поле заказа. Возвращает строку ошибки или `null`, если значение корректно.                      |


---

**DIContainer**

Класс DIContainer реализует простой механизм Dependency Injection (DI) с поддержкой singleton и transient областей жизненного цикла.

Позволяет регистрировать зависимости (провайдеры) и автоматически разрешать их с учётом указанного скоупа и вложенных зависимостей

**Свойства**

| Свойство      | Тип                       | Описание                                                                                    |
| ------------- | ------------------------- | ------------------------------------------------------------------------------------------- |
| `_registry`   | `Map<string, DIProvider>` | Реестр зарегистрированных провайдеров: хранит информацию о классах, зависимостях и скоупах. |
| `_singletons` | `Map<string, any>`        | Хранилище уже созданных singleton-экземпляров.                                              |

**Методы**

| Метод                           | Аргументы                                                                                                                                                     | Возвращает | Описание                                                                                                                                                                                         |
| ------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `register<T>(key, DIProvider?)` | - `key: DIConstructor<T>` – класс для регистрации<br>- `DIProvider?: Partial<DIProvider<T>>` – параметры регистрации (опционально: класс, зависимости, скоуп) | `void`     | Регистрирует класс и его зависимости. Проверяет соответствие числа зависимостей числу параметров конструктора. По умолчанию скоуп — `singleton`.                                                 |
| `resolve<T>(key)`               | - `key: string \| DIConstructor<T>` — имя класса или сам конструктор                                                                                          | `T`        | Создаёт и возвращает экземпляр. Повторно использует singleton-экземпляр, если указан `singleton`. Вложенные зависимости разрешаются автоматически. Бросает ошибку, если ключ не зарегистрирован. |

## Модели данных и типы:

### Типы и интерфейсы

**ProductCategory**  
Тип, определяющий возможные категории продукта

```
type ProductCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```
---

Интерфейс описывает товар:  
  id — уникальный идентификатор товара.  
  description — описание товара.  
  image — ссылка на изображение.  
  title — название.  
  category — категория (тип ProductCategory).  
  price — цена товара или null, если товар недоступен для покупки.

```
interface Product {
  id: string;
  description: string;
  image: string;
  title: string;
  category: ProductCategory;
  price: number | null;
}
```

---

**Payment**

```
type Payment = 'online' | 'offline';
```

Тип метода оплаты:  
  'online' — онлайн-оплата,  
  'offline' — оплата при получении

---

**CreateOrderRequest**

```
interface CreateOrderRequest {
  payment: Payment;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Интерфейс для отправки заказа:  
  payment — способ оплаты.  
  email — адрес электронной почты покупателя.  
  phone — номер телефона.  
  address — адрес доставки.  
  total — итоговая сумма заказа.
  items — массив id товаров в заказе

---

**CreateOrderResponse**

```
interface CreateOrderResponse {
  id: string;
  total: number;
}
```

Ответ сервера на создание заказа:
  id — идентификатор созданного заказа.
  total — подтверждённая сумма

---

**GetAllProductsResponse**

```
interface GetAllProductsResponse {
  total: number;
  items: Product[];
}
```

Ответ API при получении списка продуктов:  
  total — общее количество товаров.  
  items — массив объектов типа Product

---

**Order**

```
interface Order {
  payment: Payment;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Полное представление заказа в приложении (аналог CreateOrderRequest), может использоваться локально.

---
**ComponentRegistryInfo**  
Интерфейс, описывающий регистрационную информацию о компоненте, зарегистрированном в ComponentRegistryService.  
Используется для хранения связи между компонентом и его DOM-элементом, а также для идентификации.  
Этот интерфейс играет ключевую роль в ComponentRegistryService, обеспечивая доступ к компоненту как по экземпляру, так и по DOM-элементу.

**Свойства**  
| Свойство   | Тип             | Описание                                                                |
| ---------- | --------------- | ----------------------------------------------------------------------- |
| `instance` | `BaseComponent` | Экземпляр компонента, реализующего `BaseComponent`                      |
| `element`  | `HTMLElement`   | DOM-элемент, сгенерированный компонентом и зарегистрированный в реестре |
| `id`       | `string`        | Уникальный идентификатор компонента, используемый для отслеживания      |

---
**RegisteredElement**  
Тип-обёртка над стандартным HTMLElement, используемый для обозначения DOM-элементов, зарегистрированных в ComponentRegistryService.

**Назначение**  
Обеспечивает типовую безопасность: помогает отличать обычные DOM-элементы от тех, которые прошли регистрацию в ComponentRegistryService.  
Используется внутри компонентов, чтобы гарантировать, что элемент был создан и зарегистрирован корректно.

**Свойства**  
| Свойство            | Тип    | Описание                                                                                  |
| ------------------- | ------ | ----------------------------------------------------------------------------------------- |
| Все свойства `T`    | `T`    | Все стандартные свойства переданного типа `HTMLElement` (например, `div`, `span` и т. д.) |
| `__registeredBrand` | `true` | Специальный "бренд" (маркер), помечающий элемент как прошедший регистрацию                |

---
**Перечисление  
EventNames**

```
enum EventNames {
  OPEN_CARD_FULL = 'open-card-full',
  BASKET = 'basket',
  OPEN_CART = 'open-cart',
  ORDER = 'order',
  OPEN_ORDER_ADDRESS_PAYMENT = 'open-order-address-payment',
  OPEN_ORDER_EMAIL_PHONE = 'open-order-email-phone',
  OPEN_SUCCESS_ORDER = 'open-success-order',
}
```

Перечисление ключевых событий в приложении. Используется для взаимодействия между компонентами через событийную систему

---

**Объект сопоставления  
categoryCompareObj**

```
const categoryCompareObj = {
  'софт-скил': 'soft',
  'дополнительное': 'additional',
  'другое': 'other',
  'кнопка': 'button',
  'хард-скил': 'hard'
};
```

Объект, сопоставляющий внутренние категории (ProductCategory). Используется для задания CSS классов для категорий.


---

## Типы для DI контейнера

Конструктор, который может быть вызван с любыми аргументами и создаёт объект типа T
```
type DIConstructor<T = any> = new (...args: any[]) => T;
```

---

Область жизненного цикла:  
- 'singleton' — один экземпляр на контейнер;
- 'transient' — каждый вызов создает новый экземпляр

```
type DIScope = 'singleton' | 'transient';
```

---

Провайдер описывает, как создать и зарегистрировать класс в контейнере
```
interface DIProvider<T = any> {
  useClass: DIConstructor<T>;
  deps?: (string | DIConstructor)[];
  scope?: DIScope;
}
```
| Свойство   | Тип                | Описание                                    |                                                 |
| ---------- | ------------------ | ------------------------------------------- | ----------------------------------------------- |
| `useClass` | `DIConstructor<T>` | Класс, создаваемый контейнером              |                                                 |
| `deps`     | string или DIConstructor)[]                                   | Массив зависимостей, передаваемых в конструктор |
| `scope`    | `DIScope`          | Жизненный цикл (по умолчанию `'singleton'`) |                                                 |


---

Интерфейс для классов, которые могут использоваться в DI. Поле inject содержит массив зависимостей, которые необходимо внедрить в конструктор

```
interface DIInjectable<T = any> {
  new (...args: any[]): T;
  inject?: DIConstructor<any>[];
}
```
**inject**  
Функция inject используется для получения (разрешения) зависимости из глобального DI-контейнера.

| Аргумент | Тип                          | Описание                                                                |
| -------- | ---------------------------- | ----------------------------------------------------------------------- |
| `key`    | `DIConstructor<T> \| string` | Класс или строковое имя зависимости, зарегистрированной в DI-контейнере |

| Возвращает | Тип | Описание              |
| ---------- | --- | --------------------- |
| `T`        | —   | Экземпляр зависимости |

| Особенности                                                                |
| -------------------------------------------------------------------------- |
| Делегирует вызов в `container.resolve(...)`                                |
| Возвращает singleton или transient экземпляр в зависимости от конфигурации |
---
**DI_INIT**

DI_INIT — это уникальный символ, используемый как "хук инициализации" внутри DI-контейнера. Если класс содержит метод под ключом DI_INIT, этот метод будет автоматически вызван после создания экземпляра, когда все зависимости уже внедрены.

| Свойство  | Тип      | Значение            | Описание                                                                  |
| --------- | -------- | ------------------- | ------------------------------------------------------------------------- |
| `DI_INIT` | `symbol` | `Symbol('di_init')` | Специальный символ, распознаваемый DI-контейнером как метод инициализации |

**Назначение**  
| Назначение                | Пример                                       |
| ------------------------- | -------------------------------------------- |
| Пост-инициализация        | Настройка после внедрения зависимостей       |
| Отложенное подключение    | Подписка на события, инициализация состояния |
| Жизненный цикл компонента | Поддержка hook-подобного поведения           |
